<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Network Design on firebirdテクテクテクブログ</title><link>https://firebird-techtalktech.com/tags/network-design/</link><description>Recent content in Network Design on firebirdテクテクテクブログ</description><generator>Hugo -- gohugo.io</generator><language>ja</language><copyright>トミー</copyright><lastBuildDate>Sun, 14 Sep 2025 18:00:00 +0900</lastBuildDate><atom:link href="https://firebird-techtalktech.com/tags/network-design/index.xml" rel="self" type="application/rss+xml"/><item><title>[IP Address Hell] 192.168.1.0 Duplicate Design Causes Company-wide Network Chaos → 72-Hour Emergency Redesign Battle</title><link>https://firebird-techtalktech.com/post/ip-address-hell-192.168.1.0-duplicate-design-causes-company-wide-network-chaos-72-hour-emergency-redesign-battle/</link><pubDate>Sun, 14 Sep 2025 18:00:00 +0900</pubDate><guid>https://firebird-techtalktech.com/post/ip-address-hell-192.168.1.0-duplicate-design-causes-company-wide-network-chaos-72-hour-emergency-redesign-battle/</guid><description>&lt;h1 id="ip-address-hell-19216810-duplicate-design-causes-company-wide-network-chaos--72-hour-emergency-redesign-battle">[IP Address Hell] 192.168.1.0 Duplicate Design Causes Company-wide Network Chaos → 72-Hour Emergency Redesign Battle
&lt;/h1>&lt;h2 id="prologue-everyone-uses-19216810-so-its-safe">Prologue: &amp;ldquo;Everyone Uses 192.168.1.0, So It&amp;rsquo;s Safe&amp;rdquo;
&lt;/h2>&lt;p>&lt;strong>Tuesday, August 20, 2025, 10:00 AM&lt;/strong>&lt;/p>
&lt;p>&amp;ldquo;IP address design? Just use 192.168.1.0 and you can&amp;rsquo;t go wrong. It&amp;rsquo;s the standard address everyone uses.&amp;rdquo;&lt;/p>
&lt;p>At the company-wide network integration project planning meeting, I answered casually. Little did I know that this &amp;ldquo;everyone uses it&amp;rdquo; would trigger a company-wide disaster&amp;hellip;&lt;/p>
&lt;p>This is the record of 72 hours of hell caused by ignorance about IP address design.&lt;/p>
&lt;h2 id="chapter-1-the-illusion-of-standard-19216810">Chapter 1: The Illusion of &amp;ldquo;Standard&amp;rdquo; 192.168.1.0
&lt;/h2>&lt;h3 id="site-by-site-network-configuration-at-the-time">Site-by-Site Network Configuration at the Time
&lt;/h3>&lt;p>&lt;strong>Each Site Network as of June 2025&lt;/strong>&lt;/p>
&lt;p>Due to rapid growth, our company had expanded to 5 sites nationwide. Each site&amp;rsquo;s network administrator had built systems &amp;ldquo;independently&amp;rdquo; resulting in&amp;hellip;&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Head Office (Tokyo):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─ Network: 192.168.1.0/24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─ Gateway: 192.168.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─ DHCP Range: 192.168.1.100-200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─ Servers: 192.168.1.10-50
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─ Employee PCs: 120 units
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Osaka Branch:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─ Network: 192.168.1.0/24 ← Same!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─ Gateway: 192.168.1.1 ← Same!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─ DHCP Range: 192.168.1.100-200 ← Same!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─ Servers: 192.168.1.10-50 ← Same!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─ Employee PCs: 80 units
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Nagoya Branch:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─ Network: 192.168.1.0/24 ← Same!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─ Gateway: 192.168.1.1 ← Same!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─ DHCP Range: 192.168.1.100-200 ← Same!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─ Servers: 192.168.1.10-50 ← Same!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─ Employee PCs: 45 units
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Fukuoka Branch:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─ Network: 192.168.1.0/24 ← Same!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─ Gateway: 192.168.1.1 ← Same!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─ DHCP Range: 192.168.1.100-200 ← Same!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─ Servers: 192.168.1.10-50 ← Same!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─ Employee PCs: 30 units
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sapporo Branch:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─ Network: 192.168.1.0/24 ← Same!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─ Gateway: 192.168.1.1 ← Same!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─ DHCP Range: 192.168.1.100-200 ← Same!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─ Servers: 192.168.1.10-50 ← Same!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─ Employee PCs: 25 units
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&amp;ldquo;All sites have the same configuration, so there&amp;rsquo;s consistency. Good.&amp;rdquo;&lt;/p>
&lt;h3 id="august-20-vpn-integration-project-launch">August 20: VPN Integration Project Launch
&lt;/h3>&lt;p>&lt;strong>Project Background&lt;/strong>&lt;/p>
&lt;p>Following the COVID-19 pandemic, to promote remote work and digital transformation, we decided to connect all sites via VPN to build an integrated network environment.&lt;/p>
&lt;p>&lt;strong>Planned Post-Integration Configuration:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"> [Internet]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ↓
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> [Head Office Main Firewall]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ↓
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> [Head Office LAN: 192.168.1.0/24]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ↓
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ┌─────────[VPN Hub]─────────┐
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ↓ ↓
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> [Osaka Branch VPN] [Nagoya Branch VPN]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 192.168.1.0/24 192.168.1.0/24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ↓ ↓
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> [Fukuoka Branch VPN] [Sapporo Branch VPN]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 192.168.1.0/24 192.168.1.0/24
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&amp;ldquo;Now we can access head office servers from anywhere! Perfect!&amp;rdquo;&lt;/p>
&lt;h3 id="initial-setup-work-smooth-start">Initial Setup Work: Smooth Start
&lt;/h3>&lt;p>&lt;strong>August 21: VPN Connection Construction Begins&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Head office VPN server configuration&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># /etc/openvpn/server.conf&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">port &lt;span class="m">1194&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">proto udp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dev tun
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">server 192.168.1.0 255.255.255.0 &lt;span class="c1"># Same segment as head office&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Osaka branch VPN configuration &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># /etc/openvpn/client.conf&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">remote tokyo-vpn.company.com &lt;span class="m">1194&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dev tun
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>First connection test (August 21 afternoon):&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Connection test from Osaka branch&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ping 192.168.1.10 &lt;span class="c1"># Head office server&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># PING 192.168.1.10: 56 data bytes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 64 bytes from 192.168.1.10: icmp_seq=0 ttl=64 time=15.2 ms&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 64 bytes from 192.168.1.10: icmp_seq=1 ttl=64 time=14.8 ms&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&amp;ldquo;Great! It connected! That was easy!&amp;rdquo;&lt;/p>
&lt;h2 id="chapter-2-august-22---beginning-of-hell">Chapter 2: August 22 - Beginning of Hell
&lt;/h2>&lt;h3 id="900-am-emergency-call-from-osaka-branch">9:00 AM: Emergency Call from Osaka Branch
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Osaka Branch IT Staff: &amp;#34;Something strange is happening&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Me: &amp;#34;What&amp;#39;s wrong?&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Osaka Branch IT Staff: &amp;#34;Sometimes we can access head office file server, sometimes we can&amp;#39;t&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Me: &amp;#34;Is the VPN connection stable?&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Osaka Branch IT Staff: &amp;#34;The connection is stable, but sometimes Osaka&amp;#39;s file server appears instead&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Me: &amp;#34;Huh?&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="1100-am-the-core-problem-becomes-visible">11:00 AM: The Core Problem Becomes Visible
&lt;/h3>&lt;p>&lt;strong>Routing table check:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Head office routing table&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route -n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Destination Gateway Genmask Iface
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.0 0.0.0.0 255.255.255.0 eth0 &lt;span class="c1"># Local&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.0 10.8.0.6 255.255.255.0 tun0 &lt;span class="c1"># VPN (Osaka)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.0 10.8.0.10 255.255.255.0 tun0 &lt;span class="c1"># VPN (Nagoya)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&amp;ldquo;Ah&amp;hellip; multiple routes to the same destination&amp;hellip;&amp;rdquo;&lt;/p>
&lt;p>&lt;strong>Packet capture revealed the horrifying truth:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Access to 192.168.1.10 (file server)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tcpdump -i any host 192.168.1.10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Results:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 09:15:23 Osaka PC → 192.168.1.10 → Osaka file server&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 09:15:45 Osaka PC → 192.168.1.10 → Head office file server &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 09:16:12 Osaka PC → 192.168.1.10 → Nagoya file server&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&amp;ldquo;It&amp;rsquo;s randomly connecting to different servers&amp;hellip; this is bad.&amp;rdquo;&lt;/p>
&lt;h3 id="200-pm-major-chaos-after-all-branch-connections">2:00 PM: Major Chaos After All Branch Connections
&lt;/h3>&lt;p>&lt;strong>Situation after completing VPN connections to all sites:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Routing table hell:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Destination Gateway Iface Priority
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.0 0.0.0.0 eth0 0 # Head office local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.0 10.8.0.6 tun0 0 # Osaka VPN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.0 10.8.0.10 tun0 0 # Nagoya VPN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.0 10.8.0.14 tun0 0 # Fukuoka VPN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.0 10.8.0.18 tun0 0 # Sapporo VPN
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>5 routes competing with same priority&lt;/strong>&lt;/p>
&lt;h3 id="400-pm-severe-business-impact">4:00 PM: Severe Business Impact
&lt;/h3>&lt;p>&lt;strong>Reports of confusion from each site:&lt;/strong>&lt;/p>
&lt;p>&lt;strong>Osaka Branch:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;#34;Thought I saved a file, but it was saved to Nagoya branch server&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;#34;Tried to access accounting data, but Fukuoka&amp;#39;s data appeared&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;#34;Can&amp;#39;t find printer (referencing Sapporo printer)&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>Nagoya Branch:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;#34;Customer database showing Osaka inventory data instead&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;#34;Mail server connection intermittent&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;#34;Company chat mixing with people from other branches&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>Fukuoka Branch:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;#34;Important proposal document being simultaneously edited by head office person, causing conflicts&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;#34;Timecard system mixing employee data from other branches&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>Sapporo Branch:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;#34;Inventory management system contaminated with Fukuoka products&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;#34;Employee list in attendance system completely messed up&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="600-pm-emergency-response-headquarters-established">6:00 PM: Emergency Response Headquarters Established
&lt;/h3>&lt;p>&lt;strong>Damage situation summary:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;strong>Data integrity&lt;/strong>: Each site&amp;rsquo;s server contaminated with other sites&amp;rsquo; data&lt;/li>
&lt;li>&lt;strong>Security&lt;/strong>: Unintended access to other sites&amp;rsquo; confidential data&lt;/li>
&lt;li>&lt;strong>Business continuity&lt;/strong>: All core systems operating unstably&lt;/li>
&lt;li>&lt;strong>Reliability&lt;/strong>: Unknown where saved files are located&lt;/li>
&lt;/ul>
&lt;p>&amp;ldquo;The entire company&amp;rsquo;s foundation systems have collapsed&amp;hellip;&amp;rdquo;&lt;/p>
&lt;h2 id="chapter-3-root-cause-analysis-and-emergency-measures">Chapter 3: Root Cause Analysis and Emergency Measures
&lt;/h2>&lt;h3 id="understanding-the-routing-conflict-mechanism">Understanding the Routing Conflict Mechanism
&lt;/h3>&lt;p>&lt;strong>Problem essence: IP address space overlap&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Previously (independent sites):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Head office: [192.168.1.10] → Head office file server ✓
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Osaka: [192.168.1.10] → Osaka file server ✓
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Nagoya: [192.168.1.10] → Nagoya file server ✓
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">After VPN integration:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">All sites: [192.168.1.10] → ???Which server???
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ↓Randomly distributed
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Head office OR Osaka OR Nagoya OR Fukuoka OR Sapporo
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>Routing decision mechanism:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Linux kernel routing decision&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># When multiple routes to same destination exist:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1. Decide by metric value &lt;span class="o">(&lt;/span>priority&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2. If same metric, load balance &lt;span class="o">(&lt;/span>Round Robin&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">3. Result: Different server connection each access
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="august-22-night-emergency-countermeasures">August 22 night: Emergency Countermeasures
&lt;/h3>&lt;p>&lt;strong>Immediately cut VPN connections:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Stop all branch VPNs&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl stop openvpn@client-osaka
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl stop openvpn@client-nagoya
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl stop openvpn@client-fukuoka
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl stop openvpn@client-sapporo
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Completely block inter-site communication&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -A FORWARD -s 10.8.0.0/24 -j DROP
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>Emergency notice to all sites:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Subject: [EMERGENCY] VPN Integration Project Temporary Suspension Notice
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">All employees,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Serious network communication problems occurred due to VPN integration started today.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">To ensure data integrity, we are implementing the following measures:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1. Emergency stop of all inter-site VPN connections
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2. Continue business operations with each site&amp;#39;s local network only
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">3. Temporarily stop inter-site data synchronization
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">4. Estimated 72 hours to recovery
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">We apologize for the inconvenience.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="august-23-data-damage-investigation">August 23: Data Damage Investigation
&lt;/h3>&lt;p>&lt;strong>Database integrity check at each site:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- Customer database duplication check
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">customer_id&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">COUNT&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">customers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">GROUP&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">BY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">customer_id&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">HAVING&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">COUNT&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Results&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Head&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">office&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">DB&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">347&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">duplicate&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">records&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">other&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sites&lt;/span>&lt;span class="s1">&amp;#39; data contamination)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">Osaka DB: 1,892 duplicate records
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">Nagoya DB: 1,234 duplicate records
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">Fukuoka DB: 897 duplicate records
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">Sapporo DB: 654 duplicate records
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>File server contamination situation:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Inter-site file contamination investigation&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">find /shared -name &lt;span class="s2">&amp;#34;*.docx&amp;#34;&lt;/span> -exec grep -l &lt;span class="s2">&amp;#34;Osaka&amp;#34;&lt;/span> &lt;span class="o">{}&lt;/span> &lt;span class="se">\;&lt;/span> &lt;span class="p">|&lt;/span> wc -l
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Head office server with Osaka-specific files: 156 files&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Osaka server with head office files: 203 files&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Nagoya server with other sites&amp;#39; files: 89 files&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&amp;ldquo;Data is completely jumbled&amp;hellip; this is serious.&amp;rdquo;&lt;/p>
&lt;h2 id="chapter-4-72-hour-emergency-ip-address-redesign">Chapter 4: 72-Hour Emergency IP Address Redesign
&lt;/h2>&lt;h3 id="august-23-night-new-ip-address-system-design">August 23 night: New IP Address System Design
&lt;/h3>&lt;p>&lt;strong>Design principle review:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">Failed design&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Problem&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">All sites using same IP address range&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Cause&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Lack of understanding of IP address conflicts&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Result&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Routing conflicts &amp;amp; data contamination&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">New design principles&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="l">. Hierarchical IP address system&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="m">2&lt;/span>&lt;span class="l">. Complete site separation&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="m">3&lt;/span>&lt;span class="l">. Ensure future scalability&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="m">4&lt;/span>&lt;span class="l">. Management ease&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>New IP address design:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Hierarchical design: 10.{site}.{department}.{host}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Site code definition:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─ Head Office (Tokyo): 10.1.x.x/16
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─ Osaka Branch: 10.2.x.x/16
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─ Nagoya Branch: 10.3.x.x/16
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─ Fukuoka Branch: 10.4.x.x/16
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─ Sapporo Branch: 10.5.x.x/16
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Department code (common across sites):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─ General departments: x.1.x/24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─ Accounting department: x.2.x/24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─ Development department: x.3.x/24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─ Servers: x.99.x/24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─ Network equipment: x.254.x/24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Examples:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Head office accounting: 10.1.2.0/24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Osaka development: 10.2.3.0/24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Nagoya servers: 10.3.99.0/24
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="august-24-phased-migration-plan">August 24: Phased Migration Plan
&lt;/h3>&lt;p>&lt;strong>Migration phase design:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">Phase_1_Design&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Duration&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;24 hours&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Target&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;Head office &amp;amp; Osaka branch&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Method&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;Weekend work forced switchover&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Head office migration&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">From&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">192.168.1.0&lt;/span>&lt;span class="l">/24&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">To&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">10.1.0.0&lt;/span>&lt;span class="l">/16&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Osaka migration&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">From&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">192.168.1.0&lt;/span>&lt;span class="l">/24&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">To&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">10.2.0.0&lt;/span>&lt;span class="l">/16&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Phase_2_Implementation&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Duration&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;24 hours&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Target&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;Nagoya &amp;amp; Fukuoka branches&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Phase_3_Final&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Duration&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;24 hours&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Target&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;Sapporo branch &amp;amp; all-site VPN connection&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="august-24-night25-phase-1-implementation">August 24 night~25: Phase 1 Implementation
&lt;/h3>&lt;p>&lt;strong>Head office IP address change work (midnight work):&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 1. DHCP server configuration change&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># /etc/dhcp/dhcpd.conf&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">subnet 10.1.1.0 netmask 255.255.255.0 &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> range 10.1.1.100 10.1.1.200&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> option routers 10.1.1.1&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> option domain-name-servers 10.1.1.2&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 2. Server static IP change&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># File server: 192.168.1.10 → 10.1.99.10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Mail server: 192.168.1.11 → 10.1.99.11 &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># DB server: 192.168.1.12 → 10.1.99.12&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 3. Client PC restart (DHCP automatic acquisition)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> pc in tokyo-pc-&lt;span class="o">{&lt;/span>001..120&lt;span class="o">}&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">do&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssh admin@&lt;span class="nv">$pc&lt;/span> &lt;span class="s2">&amp;#34;sudo reboot&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">done&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>Osaka branch simultaneous work:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Remote work (coordination with Osaka local IT staff)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># DHCP configuration change&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">subnet 10.2.1.0 netmask 255.255.255.0 &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> range 10.2.1.100 10.2.1.200&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> option routers 10.2.1.1&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> option domain-name-servers 10.2.1.2&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Server IP change&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># File server: 192.168.1.10 → 10.2.99.10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Print server: 192.168.1.11 → 10.2.99.11&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="august-25-morning-phase-1-connection-test">August 25 morning: Phase 1 Connection Test
&lt;/h3>&lt;p>&lt;strong>VPN connection test with new IP addresses:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Head office→Osaka access test&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ping 10.2.99.10 &lt;span class="c1"># Osaka file server&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># PING 10.2.99.10: 56 data bytes &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 64 bytes from 10.2.99.10: icmp_seq=0 ttl=64 time=16.3 ms&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Osaka→Head office access test &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ping 10.1.99.10 &lt;span class="c1"># Head office file server&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># PING 10.1.99.10: 56 data bytes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 64 bytes from 10.1.99.10: icmp_seq=0 ttl=64 time=15.8 ms&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&amp;ldquo;Yes! They can be clearly distinguished now!&amp;rdquo;&lt;/p>
&lt;h3 id="august-25-26-phase-2-3-remaining-sites-migration">August 25-26: Phase 2-3 Remaining Sites Migration
&lt;/h3>&lt;p>&lt;strong>Phased migration of Nagoya, Fukuoka, Sapporo:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">Migration results&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Nagoya Branch&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">Old&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">192.168.1.0&lt;/span>&lt;span class="l">/24 &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">New&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">10.3.0.0&lt;/span>&lt;span class="l">/16 ✓&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Fukuoka Branch&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">Old&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">192.168.1.0&lt;/span>&lt;span class="l">/24&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">New&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">10.4.0.0&lt;/span>&lt;span class="l">/16 ✓&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Sapporo Branch&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">Old&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">192.168.1.0&lt;/span>&lt;span class="l">/24&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">New&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">10.5.0.0&lt;/span>&lt;span class="l">/16 ✓&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="chapter-5-integrated-network-completion-and-verification">Chapter 5: Integrated Network Completion and Verification
&lt;/h2>&lt;h3 id="august-26-night-all-site-vpn-reconnection">August 26 night: All-Site VPN Reconnection
&lt;/h3>&lt;p>&lt;strong>New VPN routing configuration:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Head office VPN server configuration&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># /etc/openvpn/server.conf&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">server 172.16.0.0 255.255.0.0 &lt;span class="c1"># VPN segment (conflict avoidance)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Routing configuration&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">push &lt;span class="s2">&amp;#34;route 10.1.0.0 255.255.0.0&amp;#34;&lt;/span> &lt;span class="c1"># Route to head office&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">push &lt;span class="s2">&amp;#34;route 10.2.0.0 255.255.0.0&amp;#34;&lt;/span> &lt;span class="c1"># Route to Osaka &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">push &lt;span class="s2">&amp;#34;route 10.3.0.0 255.255.0.0&amp;#34;&lt;/span> &lt;span class="c1"># Route to Nagoya&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">push &lt;span class="s2">&amp;#34;route 10.4.0.0 255.255.0.0&amp;#34;&lt;/span> &lt;span class="c1"># Route to Fukuoka&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">push &lt;span class="s2">&amp;#34;route 10.5.0.0 255.255.0.0&amp;#34;&lt;/span> &lt;span class="c1"># Route to Sapporo&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Access control from each site&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -A FORWARD -s 10.2.0.0/16 -d 10.1.99.0/24 -j ACCEPT &lt;span class="c1"># Osaka→Head office servers&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -A FORWARD -s 10.3.0.0/16 -d 10.1.99.0/24 -j ACCEPT &lt;span class="c1"># Nagoya→Head office servers&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="final-connection-test-perfect-operation">Final Connection Test: Perfect Operation
&lt;/h3>&lt;p>&lt;strong>Integrated test from each site (August 26 late night):&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Test from Osaka branch&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ping 10.1.99.10 &lt;span class="c1"># Head office file server ✓&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ping 10.3.99.10 &lt;span class="c1"># Nagoya file server ✓&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ping 10.4.99.10 &lt;span class="c1"># Fukuoka file server ✓ &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ping 10.5.99.10 &lt;span class="c1"># Sapporo file server ✓&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># File sharing test&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mount -t cifs //10.1.99.10/shared /mnt/tokyo-share ✓
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mount -t cifs //10.3.99.10/shared /mnt/nagoya-share ✓
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Database connection test&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mysql -h 10.1.99.12 -u osaka_user -p company_db ✓
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>Routing table confirmation:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">route -n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Destination Gateway Genmask Iface
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">10.1.0.0 172.16.0.1 255.255.0.0 tun0 &lt;span class="c1"># Head office&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">10.2.0.0 0.0.0.0 255.255.0.0 eth0 &lt;span class="c1"># Osaka (self)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">10.3.0.0 172.16.0.1 255.255.0.0 tun0 &lt;span class="c1"># Nagoya&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">10.4.0.0 172.16.0.1 255.255.0.0 tun0 &lt;span class="c1"># Fukuoka &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">10.5.0.0 172.16.0.1 255.255.0.0 tun0 &lt;span class="c1"># Sapporo&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&amp;ldquo;Perfect! Each site is clearly distinguished!&amp;rdquo;&lt;/p>
&lt;h2 id="chapter-6-operations-start-and-unexpected-benefits">Chapter 6: Operations Start and Unexpected Benefits
&lt;/h2>&lt;h3 id="august-27-business-operations-resume">August 27: Business Operations Resume
&lt;/h3>&lt;p>&lt;strong>Reports from each site:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Head office: &amp;#34;Can clearly access all sites&amp;#39; file servers&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Osaka: &amp;#34;Customer data contamination resolved, safe access&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Nagoya: &amp;#34;Printers also recognize correct site ones&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Fukuoka: &amp;#34;Inventory system working normally, can also reference other sites&amp;#39; data&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sapporo: &amp;#34;Attendance system stable, company-wide integration features also working&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="unexpected-side-effects">Unexpected Side Effects
&lt;/h3>&lt;h4 id="1-significant-security-improvement">1. Significant Security Improvement
&lt;/h4>&lt;p>&lt;strong>IP address-based access control now possible:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Site-based access control rules&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Accounting system accessible only from head office and Osaka&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -A FORWARD -s 10.1.2.0/24 -d 10.1.99.13 -j ACCEPT &lt;span class="c1"># Head office accounting→Accounting server&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -A FORWARD -s 10.2.2.0/24 -d 10.1.99.13 -j ACCEPT &lt;span class="c1"># Osaka accounting→Accounting server&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -A FORWARD -s 0.0.0.0/0 -d 10.1.99.13 -j DROP &lt;span class="c1"># Others denied&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Development environment accessible only to development departments&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -A FORWARD -s 10.1.3.0/24 -d 10.1.99.15 -j ACCEPT &lt;span class="c1"># Head office dev→Dev server&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -A FORWARD -s 10.2.3.0/24 -d 10.1.99.15 -j ACCEPT &lt;span class="c1"># Osaka dev→Dev server&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="2-network-monitoring-efficiency">2. Network Monitoring Efficiency
&lt;/h4>&lt;p>&lt;strong>Site-based traffic analysis now possible:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Network monitoring script&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">analyze_traffic&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">traffic_by_location&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;Head Office&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">monitor_subnet&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;10.1.0.0/16&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;Osaka&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">monitor_subnet&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;10.2.0.0/16&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;Nagoya&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">monitor_subnet&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;10.3.0.0/16&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;Fukuoka&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">monitor_subnet&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;10.4.0.0/16&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;Sapporo&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">monitor_subnet&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;10.5.0.0/16&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">location&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">traffic&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">traffic_by_location&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">items&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">location&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">: &lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">traffic&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;bandwidth&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">Mbps, &lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">traffic&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;connections&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2"> connections&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="3-clear-failure-impact-scope">3. Clear Failure Impact Scope
&lt;/h4>&lt;p>&lt;strong>Site-based failure isolation:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">Before (overlap era)&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Failure occurs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;192.168.1.10 failure&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Impact scope&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;Unknown (all sites possible)&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Recovery work&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;All sites investigation needed&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">After (hierarchical)&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Failure occurs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;10.2.99.10 failure&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Impact scope&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;Osaka branch only&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Recovery work&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;Focus on Osaka branch&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="6-months-later-quantitative-effects">6 Months Later Quantitative Effects
&lt;/h3>&lt;p>&lt;strong>Network management efficiency:&lt;/strong>&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Item&lt;/th>
&lt;th>Old Environment&lt;/th>
&lt;th>New Environment&lt;/th>
&lt;th>Improvement&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;strong>Failure identification time&lt;/strong>&lt;/td>
&lt;td>Average 45 min&lt;/td>
&lt;td>Average 8 min&lt;/td>
&lt;td>82% reduction&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>Security incidents&lt;/strong>&lt;/td>
&lt;td>7/month&lt;/td>
&lt;td>1/month&lt;/td>
&lt;td>86% reduction&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>Access control setup time&lt;/strong>&lt;/td>
&lt;td>Impossible&lt;/td>
&lt;td>10 min&lt;/td>
&lt;td>New feature&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>Network monitoring accuracy&lt;/strong>&lt;/td>
&lt;td>50%&lt;/td>
&lt;td>95%&lt;/td>
&lt;td>90% improvement&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="chapter-7-lessons-learned-and-recommendations-for-other-companies">Chapter 7: Lessons Learned and Recommendations for Other Companies
&lt;/h2>&lt;h3 id="important-principles-of-ip-address-design">Important Principles of IP Address Design
&lt;/h3>&lt;h4 id="1-everyone-uses-it-is-a-danger-signal">1. &amp;ldquo;Everyone Uses It&amp;rdquo; is a Danger Signal
&lt;/h4>&lt;p>&lt;strong>Wrong judgment:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;#34;192.168.1.0 is default so it&amp;#39;s safe&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;#34;Everyone uses it so no problem&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;#34;It&amp;#39;s a standard address so it can&amp;#39;t be wrong&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>Correct judgment:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;#34;Design considering future scalability is necessary&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;#34;Conflict avoidance is the top priority&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;#34;Hierarchical system design is important&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="2-absolute-importance-of-hierarchical-design">2. Absolute Importance of Hierarchical Design
&lt;/h4>&lt;p>&lt;strong>Effective hierarchical design:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">Large enterprise recommended design&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Format&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;10.{region}.{dept}.{host}&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Benefits&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">Scalability&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">256&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">regions × 256 departments = 65,536 segments&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">Easy understanding&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Site &amp;amp; department visible from IP address&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">Management efficiency&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Systematic routing &amp;amp; firewall configuration&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">Failure isolation&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Instantly identify impact scope&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Medium enterprise recommended design&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Format&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;172.16.{site}.{subnet}&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Range&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">172.16.0.0&lt;/span>&lt;span class="l">/12&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Benefits&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">Appropriate scale&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">16&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">sites × 256 segments = 4,096 segments&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">Distinction from home use&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Clearly separate from 192.168.x.x&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Easy future cloud integration&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Small enterprise recommended design&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Format&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;192.168.{dept}.{host}&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Benefits&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">Simple&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Easy to understand&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">Department separation&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Basic segmentation&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">Low cost&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Can handle with existing equipment&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="3-correct-understanding-of-reserved-addresses">3. Correct Understanding of Reserved Addresses
&lt;/h4>&lt;p>&lt;strong>Technical reservations (absolutely avoid):&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">Network_Address&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;x.x.x.0&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Broadcast_Address&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;x.x.x.255&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>Conventional reservations (recommended):&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">Gateway&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;x.x.x.1&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">DNS_Primary&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;x.x.x.2&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">DNS_Secondary&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;x.x.x.3&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Network_Equipment&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;x.x.x.4-9&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">DHCP_Pool&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;x.x.x.10-99&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Servers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;x.x.x.100-199&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Printers_IoT&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;x.x.x.200-230&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Management&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;x.x.x.240-254&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="practical-ip-address-design-procedure">Practical IP Address Design Procedure
&lt;/h3>&lt;h4 id="step-1-requirements-analysis">Step 1: Requirements Analysis
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">Analysis_Checklist&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Current_Scale&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">Number of sites&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>?
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - &lt;span class="nt">Number of departments&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>?
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - &lt;span class="nt">Number of employees&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>?
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - &lt;span class="nt">Number of devices&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">?&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Future_Growth&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">Number of sites in 5 years&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>?
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - &lt;span class="nt">Number of employees in 10 years&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>?
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - &lt;span class="nt">IoT device deployment plan&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>?
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - &lt;span class="nt">Cloud integration plan&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">?&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Technical_Requirements&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">VPN integration necessity&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>?
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - &lt;span class="nt">Security requirements&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>?
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - &lt;span class="nt">Existing system constraints&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">?&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="step-2-ip-address-range-selection">Step 2: IP Address Range Selection
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">select_ip_range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">total_sites&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">total_subnets&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">total_hosts&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;&amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> Optimal IP address range selection based on requirements
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> &amp;#34;&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">total_hosts&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="mi">1_000_000&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s2">&amp;#34;10.0.0.0/8&amp;#34;&lt;/span> &lt;span class="c1"># Large enterprise, multi-site&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">elif&lt;/span> &lt;span class="n">total_hosts&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="mi">50_000&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s2">&amp;#34;172.16.0.0/12&amp;#34;&lt;/span> &lt;span class="c1"># Medium enterprise&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s2">&amp;#34;192.168.0.0/16&amp;#34;&lt;/span> &lt;span class="c1"># Small enterprise&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Usage example&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">recommendation&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">select_ip_range&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">total_sites&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">total_subnets&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">total_hosts&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">500&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;Recommended: &lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">recommendation&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># Recommended: 172.16.0.0/12&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="step-3-hierarchical-design-implementation">Step 3: Hierarchical Design Implementation
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">Implementation_Template&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Large_Enterprise&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Format&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;10.{region}.{dept}.{host}&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Example&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;10.1.2.100 = Tokyo, Accounting Dept, Host 100&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Medium_Enterprise&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Format&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;172.16.{site}.{subnet}&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Example&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;172.16.1.100 = Head Office, Server Segment&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Small_Enterprise&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Format&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;192.168.{dept}.{host}&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Example&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;192.168.1.100 = General Dept, Host 100&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="migration-work-best-practices">Migration Work Best Practices
&lt;/h3>&lt;h4 id="phased-migration-strategy">Phased Migration Strategy
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">Phase_Migration_Strategy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Phase_1&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Duration&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;1 week&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Scope&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;Low importance, small impact&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Target&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;Test environment&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;Some sites&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Phase_2&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Duration&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;2 weeks&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Scope&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;Medium importance, partial impact&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Target&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;Development environment&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;Non-critical sites&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Phase_3&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Duration&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;1 week&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Scope&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;High importance, company-wide impact&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Target&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;Production environment&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;Main sites&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Rollback_Plan&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Trigger&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;30% or more malfunction&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Time_Limit&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;Complete recovery within 4 hours&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Backup&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;Complete configuration backup mandatory&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="summary-ip-address-design-truth-learned-from-320000-and-72-hours">Summary: IP Address Design Truth Learned from $320,000 and 72 Hours
&lt;/h2>&lt;h3 id="project-total-cost">Project Total Cost
&lt;/h3>&lt;p>&lt;strong>Direct costs:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>Emergency work personnel costs: $150,000&lt;/li>
&lt;li>External consultant fees: $80,000&lt;/li>
&lt;li>Equipment configuration change costs: $50,000&lt;/li>
&lt;li>System outage losses: $40,000&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>Indirect costs:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>All employee business downtime: $380,000&lt;/li>
&lt;li>Data recovery &amp;amp; integrity assurance: $120,000&lt;/li>
&lt;li>Customer impact &amp;amp; trust recovery: $200,000&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>Total cost: $1,020,000&lt;/strong>&lt;/p>
&lt;p>However, the value gained was even greater.&lt;/p>
&lt;h3 id="most-important-lessons">Most Important Lessons
&lt;/h3>&lt;h4 id="1-ip-addresses-are-not-just-numbers">1. IP Addresses Are Not &amp;ldquo;Just Numbers&amp;rdquo;
&lt;/h4>&lt;p>&lt;strong>New understanding:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>IP addresses reflect the design philosophy of the entire network&lt;/li>
&lt;li>Proper design dramatically improves management efficiency&lt;/li>
&lt;li>Improper design can destroy entire organization productivity&lt;/li>
&lt;/ul>
&lt;h4 id="2-danger-of-blind-following-of-standards">2. Danger of Blind Following of &amp;ldquo;Standards&amp;rdquo;
&lt;/h4>&lt;p>&lt;strong>Truth about &amp;ldquo;everyone uses 192.168.1.0&amp;rdquo;:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>Standard configuration for home networks&lt;/li>
&lt;li>Inappropriate for enterprise use&lt;/li>
&lt;li>Completely ignores scalability considerations&lt;/li>
&lt;/ul>
&lt;h4 id="3-absolute-value-of-hierarchical-design">3. Absolute Value of Hierarchical Design
&lt;/h4>&lt;p>&lt;strong>Effects of hierarchical design:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>Management effort: 80% reduction&lt;/li>
&lt;li>Incident response: 85% faster&lt;/li>
&lt;li>Security: 90% improvement&lt;/li>
&lt;li>Scalability: Unlimited&lt;/li>
&lt;/ul>
&lt;h3 id="future-outlook-ip-address-design-20">Future Outlook: IP Address Design 2.0
&lt;/h3>&lt;p>Currently, we are working on the following as next-generation IP address design:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">Next_Generation_IP_Design&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Software_Defined_Networking&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Dynamic IP address allocation&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Automatic segmentation by purpose&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">AI optimization&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Zero_Trust_Integration&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">IP address + Identity integrated management&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Risk-based access control&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Continuous permission optimization&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Cloud_Native_Approach&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Multi-cloud IP address management &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Container-compatible address design&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Serverless environment integration&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="finally-to-avoid-making-the-same-mistakes">Finally: To Avoid Making the Same Mistakes
&lt;/h3>&lt;p>Organizations reading this article don&amp;rsquo;t need to experience the same 72 hours of hell we did.&lt;/p>
&lt;p>&lt;strong>IP Address Design Check You Can Do Right Now:&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>&lt;strong>Do IP address ranges overlap across sites?&lt;/strong>&lt;/li>
&lt;li>&lt;strong>Can you handle the next 3 years of expansion plans?&lt;/strong>&lt;/li>
&lt;li>&lt;strong>Can you identify site &amp;amp; department just by looking at IP addresses?&lt;/strong>&lt;/li>
&lt;li>&lt;strong>Do you have VPN integration or cloud migration plans?&lt;/strong>&lt;/li>
&lt;/ol>
&lt;p>If you have even one &amp;ldquo;concern,&amp;rdquo; I strongly recommend starting IP address design review immediately.&lt;/p>
&lt;p>&lt;strong>Abandon the illusion that &amp;ldquo;192.168.1.0 is universal&amp;rdquo; and build networks that support your company&amp;rsquo;s future with true hierarchical design.&lt;/strong>&lt;/p>
&lt;p>This is the most important lesson learned from $1,020,000 and 72 hours of hell.&lt;/p>
&lt;hr>
&lt;p>&lt;strong>Related articles:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://firebird-techtalktech.com/tags/network-design/" >Network Design Hierarchical Approach Practice Guide&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://firebird-techtalktech.com/categories/infrastructure/" >Enterprise-Scale IP Address Design Patterns&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://firebird-techtalktech.com/tags/vpn/" >VPN Integration Project Pitfalls and Solutions&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>Note:&lt;/strong> This article is based on actual network incident experience, but specific company names and technical details have been partially modified and anonymized.&lt;/p></description></item><item><title>[Design Hell] VPC Peering Design Mistake Causes 3-Day Company-wide System Outage → Emergency PSC Migration Battle Record</title><link>https://firebird-techtalktech.com/post/design-hell-vpc-peering-design-mistake-causes-3-day-company-wide-system-outage-emergency-psc-migration-battle-record/</link><pubDate>Sun, 14 Sep 2025 17:00:00 +0900</pubDate><guid>https://firebird-techtalktech.com/post/design-hell-vpc-peering-design-mistake-causes-3-day-company-wide-system-outage-emergency-psc-migration-battle-record/</guid><description>&lt;h1 id="design-hell-vpc-peering-design-mistake-causes-3-day-company-wide-system-outage--emergency-psc-migration-battle-record">[Design Hell] VPC Peering Design Mistake Causes 3-Day Company-wide System Outage → Emergency PSC Migration Battle Record
&lt;/h1>&lt;h2 id="prologue-the-sweet-temptation-of-easy-connection">Prologue: The Sweet Temptation of &amp;ldquo;Easy Connection&amp;rdquo;
&lt;/h2>&lt;p>&lt;strong>Monday, June 10, 2025, 11:00 AM&lt;/strong>&lt;/p>
&lt;p>&amp;ldquo;VPC connection? Just click a few times with VPC Peering. 30 minutes is enough to connect everything.&amp;rdquo;&lt;/p>
&lt;p>At the design meeting for our new multi-project environment, I answered with such confidence. Little did I know that this &amp;ldquo;easy connection&amp;rdquo; would cause a catastrophic 3-day company-wide system outage&amp;hellip;&lt;/p>
&lt;p>This is the record of the hellish experience caused by naive VPC design assumptions, and the network design truths learned from it.&lt;/p>
&lt;h2 id="chapter-1-the-trap-of-beautiful-design">Chapter 1: The Trap of &amp;ldquo;Beautiful Design&amp;rdquo;
&lt;/h2>&lt;h3 id="project-overview-multi-vpc-environment-construction">Project Overview: Multi-VPC Environment Construction
&lt;/h3>&lt;p>&lt;strong>Background:&lt;/strong>
Due to rapid company growth, we decided to separate GCP projects by department and environment.&lt;/p>
&lt;p>&lt;strong>Design Requirements:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>Ensure department independence&lt;/li>
&lt;li>Separate environments (dev/staging/prod)&lt;/li>
&lt;li>Inter-department collaboration as needed&lt;/li>
&lt;li>Connection to shared services (AD, DNS, monitoring)&lt;/li>
&lt;/ul>
&lt;h3 id="my-beautiful-design">My &amp;ldquo;Beautiful Design&amp;rdquo;
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"> [Shared Services VPC]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> shared-vpc (10.0.0.0/16)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├─ AD: 10.0.1.0/24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├─ DNS: 10.0.2.0/24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> └─ Monitoring: 10.0.3.0/24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ↓ VPC Peering
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ┌─────────────────┼─────────────────┐
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ↓ ↓ ↓
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> [Sales VPC] [Dev VPC] [Finance VPC]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sales-vpc dev-vpc finance-vpc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">(10.1.0.0/16) (10.2.0.0/16) (10.3.0.0/16)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ↓ ↓ ↓
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">VPC Peering VPC Peering VPC Peering
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ↓ ↓ ↓
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[Sales PROD] [Dev PROD] [Finance PROD]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">(10.1.0.0/24) (10.2.0.0/24) (10.3.0.0/24)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ↓ ↓ ↓
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[Sales STAGING] [Dev STAGING] [Finance STAGING]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">(10.1.1.0/24) (10.2.1.0/24) (10.3.1.0/24)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ↓ ↓ ↓
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[Sales DEV] [Dev DEV] [Finance DEV]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">(10.1.2.0/24) (10.2.2.0/24) (10.3.2.0/24)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&amp;ldquo;Perfect! Departments and environments are cleanly separated. Connect necessary parts with VPC Peering, and we have a secure, manageable network!&amp;rdquo;&lt;/p>
&lt;h3 id="june-15-optimistic-approval-in-design-review">June 15: Optimistic Approval in Design Review
&lt;/h3>&lt;p>&lt;strong>CTO:&lt;/strong> &amp;ldquo;I see, each department is independent. Good design.&amp;rdquo;&lt;/p>
&lt;p>&lt;strong>Me:&lt;/strong> &amp;ldquo;Yes, with VPC Peering for only necessary connections, security is perfect.&amp;rdquo;&lt;/p>
&lt;p>&lt;strong>Infrastructure Manager:&lt;/strong> &amp;ldquo;Are IP address conflicts okay?&amp;rdquo;&lt;/p>
&lt;p>&lt;strong>Me:&lt;/strong> &amp;ldquo;Private IP addresses, so conflicts are fine if VPCs are different.&amp;rdquo;&lt;/p>
&lt;p>&lt;strong>Security Officer:&lt;/strong> &amp;ldquo;Can unnecessary inter-department communication be blocked?&amp;rdquo;&lt;/p>
&lt;p>&lt;strong>Me:&lt;/strong> &amp;ldquo;VPC Peering only configured where needed, so control is perfect.&amp;rdquo;&lt;/p>
&lt;p>&lt;strong>Everyone:&lt;/strong> &amp;ldquo;Approved. Build it in 2 weeks.&amp;rdquo;&lt;/p>
&lt;h3 id="implementation-start-enthusiastic-vpc-creation">Implementation Start: Enthusiastic VPC Creation
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Shared services VPC&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">gcloud compute networks create shared-vpc &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --subnet-mode&lt;span class="o">=&lt;/span>custom &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --project&lt;span class="o">=&lt;/span>shared-services
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Create each department VPC&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> dept in sales dev finance&lt;span class="p">;&lt;/span> &lt;span class="k">do&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> gcloud compute networks create &lt;span class="si">${&lt;/span>&lt;span class="nv">dept&lt;/span>&lt;span class="si">}&lt;/span>-vpc &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --subnet-mode&lt;span class="o">=&lt;/span>custom &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --project&lt;span class="o">=&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">dept&lt;/span>&lt;span class="si">}&lt;/span>-project
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">done&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Create each environment VPC&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> dept in sales dev finance&lt;span class="p">;&lt;/span> &lt;span class="k">do&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> env in prod staging dev&lt;span class="p">;&lt;/span> &lt;span class="k">do&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> gcloud compute networks create &lt;span class="si">${&lt;/span>&lt;span class="nv">dept&lt;/span>&lt;span class="si">}&lt;/span>-&lt;span class="si">${&lt;/span>&lt;span class="nv">env&lt;/span>&lt;span class="si">}&lt;/span>-vpc &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --subnet-mode&lt;span class="o">=&lt;/span>custom &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --project&lt;span class="o">=&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">dept&lt;/span>&lt;span class="si">}&lt;/span>-&lt;span class="si">${&lt;/span>&lt;span class="nv">env&lt;/span>&lt;span class="si">}&lt;/span>-project
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">done&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">done&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&amp;ldquo;Going smoothly. Next create subnets and connect with VPC Peering, then done.&amp;rdquo;&lt;/p>
&lt;h2 id="chapter-2-beginning-of-hell---ip-address-overlap-nightmare">Chapter 2: Beginning of Hell - IP Address Overlap Nightmare
&lt;/h2>&lt;h3 id="june-20-construction-work-begins">June 20: Construction Work Begins
&lt;/h3>&lt;p>&lt;strong>Start VPC Peering configuration:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Shared services → Each department connection&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">gcloud compute networks peerings create shared-to-sales &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --network&lt;span class="o">=&lt;/span>shared-vpc &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --peer-project&lt;span class="o">=&lt;/span>sales-project &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --peer-network&lt;span class="o">=&lt;/span>sales-vpc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">gcloud compute networks peerings create shared-to-dev &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --network&lt;span class="o">=&lt;/span>shared-vpc &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --peer-project&lt;span class="o">=&lt;/span>dev-project &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --peer-network&lt;span class="o">=&lt;/span>dev-vpc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ... Similarly create 12 more Peerings&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>First warning sign:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">WARNING: Peering &amp;#39;shared-to-sales&amp;#39; created, but route may conflict
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">WARNING: Multiple routes to 10.0.0.0/16 detected
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">WARNING: Possible routing loop detected
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&amp;ldquo;Warnings are showing, but should be okay if tests pass.&amp;rdquo;&lt;/p>
&lt;h3 id="june-22-first-connection-test">June 22: First Connection Test
&lt;/h3>&lt;p>&lt;strong>Connection test to shared AD (10.0.1.10):&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># From Sales PROD environment&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ping 10.0.1.10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># PING 10.0.1.10: 56 data bytes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ping: cannot resolve 10.0.1.10: Unknown host&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># From Dev PROD environment &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ping 10.0.1.10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># PING 10.0.1.10: 56 data bytes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ping: sendto: No route to host&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># From Finance PROD environment&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ping 10.0.1.10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># PING 10.0.1.10: 56 data bytes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Request timeout for icmp_seq 0&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&amp;ldquo;Huh? Nothing connects&amp;hellip;&amp;rdquo;&lt;/p>
&lt;h3 id="routing-table-check-reveals-horror">Routing Table Check Reveals Horror
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Shared services VPC routing table&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">gcloud compute routes list --project&lt;span class="o">=&lt;/span>shared-services
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME NETWORK DEST_RANGE NEXT_HOP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">shared-vpc-route shared-vpc 10.0.0.0/16 shared-vpc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sales-peer-route shared-vpc 10.1.0.0/16 peering-sales
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dev-peer-route shared-vpc 10.2.0.0/16 peering-dev
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">finance-peer-route shared-vpc 10.3.0.0/16 peering-finance
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>Sales VPC routing table:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">gcloud compute routes list --project&lt;span class="o">=&lt;/span>sales-project
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME NETWORK DEST_RANGE NEXT_HOP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sales-vpc-route sales-vpc 10.1.0.0/16 sales-vpc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">shared-peer-route sales-vpc 10.0.0.0/16 peering-shared
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sales-prod-route sales-vpc 10.1.0.0/24 peering-prod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sales-stg-route sales-vpc 10.1.1.0/24 peering-staging
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sales-dev-route sales-vpc 10.1.2.0/24 peering-dev
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&amp;ldquo;Oh&amp;hellip; the routing is completely messed up&amp;hellip;&amp;rdquo;&lt;/p>
&lt;h3 id="june-23-true-nature-of-problem-revealed">June 23: True Nature of Problem Revealed
&lt;/h3>&lt;p>&lt;strong>Late-night debugging revealed fundamental problem:&lt;/strong>&lt;/p>
&lt;h4 id="1-fatal-ip-address-design-flaw">1. Fatal IP Address Design Flaw
&lt;/h4>&lt;p>Actual IP address allocation for each environment:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Sales Department:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─ sales-vpc: 10.1.0.0/16 (Department main)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─ sales-prod: 10.1.0.0/24 (Production environment) ← Overlap!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─ sales-staging: 10.1.1.0/24 (Staging)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─ sales-dev: 10.1.2.0/24 (Development environment)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Development Department:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─ dev-vpc: 10.2.0.0/16 (Department main)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─ dev-prod: 10.2.0.0/24 (Production environment) ← Overlap!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─ dev-staging: 10.2.1.0/24 (Staging)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─ dev-dev: 10.2.2.0/24 (Development environment)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>Problem:&lt;/strong> Subnet overlap between department main VPC and production environment VPC&lt;/p>
&lt;h4 id="2-vpc-peering-routing-limitations">2. VPC Peering Routing Limitations
&lt;/h4>&lt;p>VPC Peering is not &amp;ldquo;transitive&amp;rdquo;:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Sales PROD → Sales VPC → Shared VPC → Dev VPC → Dev PROD
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ↑_________________________↑
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Communication via this route impossible
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>Direct communication from Sales PROD to Dev PROD requires separate Peering&lt;/strong>&lt;/p>
&lt;h4 id="3-routing-loop-occurrence">3. Routing Loop Occurrence
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Lost packet route:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">10.1.0.10 → sales-vpc → shared-vpc → sales-prod → sales-vpc → ...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ↑__________________|
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Endless loop
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&amp;ldquo;This is completely a design mistake&amp;hellip;&amp;rdquo;&lt;/p>
&lt;h2 id="chapter-3-june-24---complete-system-outage-nightmare">Chapter 3: June 24 - Complete System Outage Nightmare
&lt;/h2>&lt;h3 id="900-am-scheduled-production-start">9:00 AM: Scheduled Production Start
&lt;/h3>&lt;p>&lt;strong>Planned migration schedule:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>09:00: New network environment goes live&lt;/li>
&lt;li>10:00: Each department system connection verification&lt;/li>
&lt;li>11:00: Business operations begin&lt;/li>
&lt;/ul>
&lt;h3 id="915-am-first-alert">9:15 AM: First Alert
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">🚨 Monitoring Alert
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Subject: [CRITICAL] Active Directory Authentication Failed
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Body: Multiple authentication failures detected
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- sales-prod: Cannot reach domain controller
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- dev-prod: Authentication timeout
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- finance-prod: LDAP connection failed
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>Authentication system malfunction across all departments&lt;/strong>&lt;/p>
&lt;h3 id="930-am-problem-chain-begins">9:30 AM: Problem Chain Begins
&lt;/h3>&lt;p>&lt;strong>Emergency call from Sales:&lt;/strong>
&amp;ldquo;Can&amp;rsquo;t log into customer management system! We have an important business meeting today!&amp;rdquo;&lt;/p>
&lt;p>&lt;strong>Slack from Development:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Dev Manager: Can&amp;#39;t deploy to production system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Dev Manager: Monitoring system also invisible
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Dev Manager: What&amp;#39;s happening?
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>Internal call from Finance:&lt;/strong>
&amp;ldquo;Payroll and accounting systems are all erroring. Today is month-end deadline!&amp;rdquo;&lt;/p>
&lt;h3 id="1000-am-emergency-response-meeting">10:00 AM: Emergency Response Meeting
&lt;/h3>&lt;p>&lt;strong>Participants:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>CTO&lt;/li>
&lt;li>Each department heads&lt;/li>
&lt;li>Entire infrastructure team&lt;/li>
&lt;li>External consultants (emergency call)&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>CTO:&lt;/strong> &amp;ldquo;What&amp;rsquo;s the situation?&amp;rdquo;&lt;/p>
&lt;p>&lt;strong>Me:&lt;/strong> &amp;ldquo;There&amp;rsquo;s a problem with VPC Peering design, routing isn&amp;rsquo;t working properly.&amp;rdquo;&lt;/p>
&lt;p>&lt;strong>Sales Manager:&lt;/strong> &amp;ldquo;When will it be fixed? We have a major project presentation today!&amp;rdquo;&lt;/p>
&lt;p>&lt;strong>Me:&lt;/strong> &amp;ldquo;We&amp;rsquo;re investigating&amp;hellip; urgently&amp;hellip;&amp;rdquo;&lt;/p>
&lt;p>&lt;strong>Dev Manager:&lt;/strong> &amp;ldquo;Staging environment is also down, so we can&amp;rsquo;t fix production either.&amp;rdquo;&lt;/p>
&lt;p>&lt;strong>CTO:&lt;/strong> &amp;ldquo;Can we roll back everything to the old environment?&amp;rdquo;&lt;/p>
&lt;p>&lt;strong>Me:&lt;/strong> &amp;ldquo;The old environment has already been decommissioned&amp;hellip; we can&amp;rsquo;t roll back&amp;hellip;&amp;rdquo;&lt;/p>
&lt;p>&lt;strong>Everyone:&lt;/strong> &amp;ldquo;&amp;hellip;&amp;hellip;&amp;rdquo; (Desperate silence)&lt;/p>
&lt;h3 id="1100-am-emergency-team-formation">11:00 AM: Emergency Team Formation
&lt;/h3>&lt;p>&lt;strong>Work assignment:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>Me: Emergency network configuration review&lt;/li>
&lt;li>Network Engineers (2): Investigation &amp;amp; fix of existing Peering&lt;/li>
&lt;li>System Engineers (3): Impact investigation for each system&lt;/li>
&lt;li>External Consultants (2): Alternative solution consideration&lt;/li>
&lt;/ul>
&lt;h3 id="100-pm-emergency-measures-attempt">1:00 PM: Emergency Measures Attempt
&lt;/h3>&lt;p>&lt;strong>Temporary fix proposal:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Emergency fix of overlapping IP addresses&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># sales-prod: 10.1.0.0/24 → 10.1.10.0/24&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">gcloud compute networks subnets create sales-prod-new &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --network&lt;span class="o">=&lt;/span>sales-prod-vpc &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --range&lt;span class="o">=&lt;/span>10.1.10.0/24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># dev-prod: 10.2.0.0/24 → 10.2.10.0/24 &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">gcloud compute networks subnets create dev-prod-new &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --network&lt;span class="o">=&lt;/span>dev-prod-vpc &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --range&lt;span class="o">=&lt;/span>10.2.10.0/24
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>Result:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">ERROR: Cannot delete subnet &amp;#39;sales-prod-subnet&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ERROR: 15 instances still attached to subnet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ERROR: Database instances cannot be moved to different subnet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ERROR: Load balancer configuration requires subnet recreation
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&amp;ldquo;Changing IP addresses requires recreating all instances&amp;hellip; this will take days.&amp;rdquo;&lt;/p>
&lt;h3 id="300-pm-alternative-solutions-consideration">3:00 PM: Alternative Solutions Consideration
&lt;/h3>&lt;p>&lt;strong>Proposals from external consultants:&lt;/strong>&lt;/p>
&lt;h4 id="option-1-vpc-peering-configuration-optimization">Option 1: VPC Peering Configuration Optimization
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>Time&lt;/strong>: 1-2 days&lt;/li>
&lt;li>&lt;strong>Risk&lt;/strong>: Unknown if routing problems completely resolved&lt;/li>
&lt;li>&lt;strong>Impact&lt;/strong>: All systems need reconstruction&lt;/li>
&lt;/ul>
&lt;h4 id="option-2-migration-to-private-service-connect-psc">Option 2: Migration to Private Service Connect (PSC)
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>Time&lt;/strong>: 2-3 days&lt;/li>
&lt;li>&lt;strong>Risk&lt;/strong>: New technology with uncertainties&lt;/li>
&lt;li>&lt;strong>Impact&lt;/strong>: Only shared services need reconstruction&lt;/li>
&lt;/ul>
&lt;h4 id="option-3-complete-rollback-reconstruct-old-environment">Option 3: Complete Rollback (Reconstruct old environment)
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>Time&lt;/strong>: 1 week&lt;/li>
&lt;li>&lt;strong>Risk&lt;/strong>: Low&lt;/li>
&lt;li>&lt;strong>Impact&lt;/strong>: Migration project completely back to square one&lt;/li>
&lt;/ul>
&lt;p>&amp;ldquo;All options are hell&amp;hellip;&amp;rdquo;&lt;/p>
&lt;h3 id="400-pm-decision-for-psc-migration">4:00 PM: Decision for PSC Migration
&lt;/h3>&lt;p>&lt;strong>Decision reasons:&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>Leads to most fundamental solution&lt;/li>
&lt;li>High future scalability&lt;/li>
&lt;li>Only requires changes to shared services&lt;/li>
&lt;/ol>
&lt;p>&lt;strong>CTO approval:&lt;/strong>
&amp;ldquo;Go with PSC. Restore within 48 hours.&amp;rdquo;&lt;/p>
&lt;h2 id="chapter-4-hells-2-days---psc-emergency-migration">Chapter 4: Hell&amp;rsquo;s 2 Days - PSC Emergency Migration
&lt;/h2>&lt;h3 id="june-24-500-pm-psc-migration-work-begins">June 24, 5:00 PM: PSC Migration Work Begins
&lt;/h3>&lt;p>&lt;strong>What is Private Service Connect:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>Safely connects service providers and consumers&lt;/li>
&lt;li>Avoids IP address conflicts&lt;/li>
&lt;li>Solves transitive routing problems&lt;/li>
&lt;li>Enables more granular access control&lt;/li>
&lt;/ul>
&lt;h4 id="step-1-convert-shared-services-to-psc-services">Step 1: Convert Shared Services to PSC Services
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># PSC setup for Active Directory service&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">gcloud compute service-attachments create ad-service &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --region&lt;span class="o">=&lt;/span>asia-northeast1 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --producer-forwarding-rule&lt;span class="o">=&lt;/span>ad-forwarding-rule &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --connection-preference&lt;span class="o">=&lt;/span>ACCEPT_AUTOMATIC &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --nat-subnets&lt;span class="o">=&lt;/span>ad-psc-subnet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># PSC setup for DNS service &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">gcloud compute service-attachments create dns-service &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --region&lt;span class="o">=&lt;/span>asia-northeast1 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --producer-forwarding-rule&lt;span class="o">=&lt;/span>dns-forwarding-rule &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --connection-preference&lt;span class="o">=&lt;/span>ACCEPT_AUTOMATIC &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --nat-subnets&lt;span class="o">=&lt;/span>dns-psc-subnet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># PSC setup for monitoring service&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">gcloud compute service-attachments create monitoring-service &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --region&lt;span class="o">=&lt;/span>asia-northeast1 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --producer-forwarding-rule&lt;span class="o">=&lt;/span>monitoring-forwarding-rule &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --connection-preference&lt;span class="o">=&lt;/span>ACCEPT_AUTOMATIC &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --nat-subnets&lt;span class="o">=&lt;/span>monitoring-psc-subnet
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="step-2-create-psc-endpoints-from-each-department-vpc">Step 2: Create PSC Endpoints from Each Department VPC
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Sales department connection to AD service&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">gcloud compute addresses create sales-ad-psc-ip &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --region&lt;span class="o">=&lt;/span>asia-northeast1 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --subnet&lt;span class="o">=&lt;/span>sales-psc-subnet &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --project&lt;span class="o">=&lt;/span>sales-project
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">gcloud compute forwarding-rules create sales-ad-endpoint &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --region&lt;span class="o">=&lt;/span>asia-northeast1 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --network&lt;span class="o">=&lt;/span>sales-vpc &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --address&lt;span class="o">=&lt;/span>sales-ad-psc-ip &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --target-service-attachment&lt;span class="o">=&lt;/span>projects/shared-services/regions/asia-northeast1/serviceAttachments/ad-service &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --project&lt;span class="o">=&lt;/span>sales-project
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="june-24-1100-pm-first-psc-connection-test">June 24, 11:00 PM: First PSC Connection Test
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Sales environment to AD connection test&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ping 10.1.100.10 &lt;span class="c1"># PSC endpoint IP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># PING 10.1.100.10: 56 data bytes &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 64 bytes from 10.1.100.10: icmp_seq=0 ttl=64 time=2.3 ms&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 64 bytes from 10.1.100.10: icmp_seq=1 ttl=64 time=1.8 ms&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&amp;ldquo;Yes! It&amp;rsquo;s connected!&amp;rdquo;&lt;/p>
&lt;h3 id="june-25-300-am-configuration-changes-at-each-department">June 25, 3:00 AM: Configuration Changes at Each Department
&lt;/h3>&lt;p>&lt;strong>Connection destination changes in each system:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Sales system configuration change&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># /etc/ldap/ldap.conf&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">URI ldap://10.1.100.10/ &lt;span class="c1"># Via PSC endpoint&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BASE &lt;span class="nv">dc&lt;/span>&lt;span class="o">=&lt;/span>company,dc&lt;span class="o">=&lt;/span>&lt;span class="nb">local&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Development system configuration change &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># /etc/sssd/sssd.conf&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ldap_uri&lt;/span> &lt;span class="o">=&lt;/span> ldap://10.2.100.10/ &lt;span class="c1"># Dev department PSC endpoint&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Finance system configuration change&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># application.properties&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ldap.server.url&lt;span class="o">=&lt;/span>ldap://10.3.100.10/ &lt;span class="c1"># Finance department PSC endpoint&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="june-25-600-am-system-connection-verification">June 25, 6:00 AM: System Connection Verification
&lt;/h3>&lt;p>&lt;strong>Operation test at each department:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Sales system verification&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl status sales-app
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">● sales-app.service - Sales Management Application
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Loaded: loaded
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Active: active &lt;span class="o">(&lt;/span>running&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Status: &lt;span class="s2">&amp;#34;Connected to AD via PSC endpoint&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Development system verification &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kubectl get pods -n production
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">api-server-7d4f8b9c 1/1 Running &lt;span class="m">0&lt;/span> 2h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">database-proxy-5c7d9 1/1 Running &lt;span class="m">0&lt;/span> 2h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">monitoring-agent-3x8k 1/1 Running &lt;span class="m">0&lt;/span> 2h
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&amp;ldquo;All systems are operating normally&amp;hellip;&amp;rdquo;&lt;/p>
&lt;h3 id="june-25-800-am-business-resumption-verification">June 25, 8:00 AM: Business Resumption Verification
&lt;/h3>&lt;p>&lt;strong>Reports from each department:&lt;/strong>&lt;/p>
&lt;p>&lt;strong>Sales:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Sales Manager: Customer management system normal
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sales Manager: Email &amp;amp; calendar also restored
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sales Manager: Made it in time for today&amp;#39;s presentation!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>Development:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Dev Manager: Both production &amp;amp; staging environments normal
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Dev Manager: CI/CD pipeline restored
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Dev Manager: Monitoring system also no problems
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>Finance:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Finance Manager: Payroll &amp;amp; accounting systems restored
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Finance Manager: Can start month-end closing process
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Finance Manager: Thank you for your hard work!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&amp;ldquo;We did it&amp;hellip; everything&amp;rsquo;s restored&amp;hellip;&amp;rdquo;&lt;/p>
&lt;h2 id="chapter-5-post-incident-analysis-and-lessons-learned">Chapter 5: Post-Incident Analysis and Lessons Learned
&lt;/h2>&lt;h3 id="stable-operation-after-recovery">Stable Operation After Recovery
&lt;/h3>&lt;p>&lt;strong>PSC migration monitoring results after 1 week:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Network connection status:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Connection success rate: 99.98%
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Average response time: 1.2ms (previously 2.5ms)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Error rate: 0.02% (previously 3.2%)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">System operation status:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Active Directory authentication: 100% success
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- DNS resolution: 99.99% success
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Monitoring system: All metrics normal
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Inter-department communication:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Unnecessary inter-department communication: Completely blocked
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Necessary shared service access: 100% success
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Security policies: Fully applied
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="root-cause-analysis">Root Cause Analysis
&lt;/h3>&lt;h4 id="1-insufficient-understanding-in-design-phase">1. Insufficient Understanding in Design Phase
&lt;/h4>&lt;p>&lt;strong>Wrong understanding:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">× VPC Peering is &amp;#34;easy and universal&amp;#34; connection method
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">× IP address conflicts are &amp;#34;no problem if VPCs are different&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">× Routing is &amp;#34;automatically optimized&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>Correct understanding:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">○ VPC Peering is connection method suitable for specific purposes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">○ IP address design requires careful consideration of overall picture
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">○ Routing requires explicit design &amp;amp; management
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="2-insufficient-understanding-of-connection-method-applications">2. Insufficient Understanding of Connection Method Applications
&lt;/h4>&lt;p>&lt;strong>VPC Peering Application Scenarios:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">Suitable cases&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Direct connection within same organization&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Full mesh connection needed&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Low latency &amp;amp; high throughput requirements&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Minimize management costs&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Unsuitable cases&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Complex hub &amp;amp; spoke topology&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Service provider/consumer relationship&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Granular access control requirements&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">IP address conflict environments&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>PSC Application Scenarios:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">Suitable cases&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Service provider/consumer relationship&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Complex multi-tenant environments&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">IP address conflicts exist&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Granular access control needed&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Unsuitable cases&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Simple direct connection&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Low latency is most important&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Minimize setup/operation costs&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="kc">No&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">protocol-level control needed&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="3-inadequate-testing--validation-process">3. Inadequate Testing &amp;amp; Validation Process
&lt;/h4>&lt;p>&lt;strong>Validation that should have been performed:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-markdown" data-lang="markdown">&lt;span class="line">&lt;span class="cl">&lt;span class="gu">## Network Design Validation Checklist
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">### Design Phase
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">&lt;/span>&lt;span class="k">- [ ]&lt;/span> IP address conflict check
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">- [ ]&lt;/span> Routing table design
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">- [ ]&lt;/span> Connectivity matrix creation
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">- [ ]&lt;/span> Security policy definition
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">### Implementation Phase
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">&lt;/span>&lt;span class="k">- [ ]&lt;/span> Phased construction (VPC by VPC)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">- [ ]&lt;/span> Connection testing at each phase
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">- [ ]&lt;/span> Load testing &lt;span class="err">&amp;amp;&lt;/span> failure testing
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">- [ ]&lt;/span> Rollback procedure confirmation
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">### Pre-Production Testing
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">&lt;/span>&lt;span class="k">- [ ]&lt;/span> All system connection verification
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">- [ ]&lt;/span> Performance measurement
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">- [ ]&lt;/span> Security testing
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">- [ ]&lt;/span> Operations procedure confirmation
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="improved-final-design">Improved Final Design
&lt;/h3>&lt;p>&lt;strong>PSC-based Hub &amp;amp; Spoke topology:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"> [Shared Services VPC]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> (Service Producer)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ┌─ AD Service (PSC)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├─ DNS Service (PSC)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> └─ Monitor Service (PSC)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ↑
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> PSC Service Attachment
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ↑
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ┌─────────────────────┼─────────────────────┐
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ↓ ↓ ↓
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[Sales VPC] [Dev VPC] [Finance VPC]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PSC Endpoint PSC Endpoint PSC Endpoint
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─ AD: 10.1.100.10 ├─ AD: 10.2.100.10 ├─ AD: 10.3.100.10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─ DNS: 10.1.100.11 ├─ DNS: 10.2.100.11 ├─ DNS: 10.3.100.11
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─ Mon: 10.1.100.12 └─ Mon: 10.2.100.12 └─ Mon: 10.3.100.12
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>Benefits:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>IP address conflict problem resolution&lt;/li>
&lt;li>Complete department isolation&lt;/li>
&lt;li>Granular access control&lt;/li>
&lt;li>Transitive routing problem resolution&lt;/li>
&lt;li>Future scalability&lt;/li>
&lt;/ul>
&lt;h3 id="cost-comparison">Cost Comparison
&lt;/h3>&lt;p>&lt;strong>VPC Peering vs PSC:&lt;/strong>&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Item&lt;/th>
&lt;th>VPC Peering&lt;/th>
&lt;th>PSC&lt;/th>
&lt;th>Difference&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;strong>Connection fees&lt;/strong>&lt;/td>
&lt;td>Free&lt;/td>
&lt;td>$0.01/hour/connection&lt;/td>
&lt;td>+$2,600/year&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>Data transfer&lt;/strong>&lt;/td>
&lt;td>Standard rates&lt;/td>
&lt;td>Standard rates&lt;/td>
&lt;td>Same&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>Operations effort&lt;/strong>&lt;/td>
&lt;td>High (complex management)&lt;/td>
&lt;td>Low (simple)&lt;/td>
&lt;td>-$50,000/year&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>Incident response&lt;/strong>&lt;/td>
&lt;td>High (this case example)&lt;/td>
&lt;td>Low&lt;/td>
&lt;td>-$100,000/year&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>Total cost&lt;/strong>&lt;/td>
&lt;td>High&lt;/td>
&lt;td>Low&lt;/td>
&lt;td>&lt;strong>-$147,400/year&lt;/strong>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>&amp;ldquo;PSC resulted in significant cost reduction overall&amp;rdquo;&lt;/p>
&lt;h2 id="chapter-6-lessons-for-other-organizations">Chapter 6: Lessons for Other Organizations
&lt;/h2>&lt;h3 id="vpc-connection-method-selection-flowchart">VPC Connection Method Selection Flowchart
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Network connection requirements
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ↓
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">┌─ IP address conflicts? ─ YES → Consider PSC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ↓ NO
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─ Service provider/consumer? ─ YES → PSC recommended
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ↓ NO
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─ Complex control needed? ─ YES → Consider PSC or Proxy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ↓ NO
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─ Ultra-low latency needed? ─ YES → VPC Peering recommended
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ↓ NO
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─ Simple direct connection? ─ YES → VPC Peering possible
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="design-checkpoints">Design Checkpoints
&lt;/h3>&lt;h4 id="1-ip-address-design">1. IP Address Design
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># IP address overlap check script example&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#!/bin/bash&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;=== IP Address Overlap Check ===&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> vpc in &lt;span class="k">$(&lt;/span>gcloud compute networks list --format&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;value(name)&amp;#34;&lt;/span>&lt;span class="k">)&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">do&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;VPC: &lt;/span>&lt;span class="nv">$vpc&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> gcloud compute networks subnets list --network&lt;span class="o">=&lt;/span>&lt;span class="nv">$vpc&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --format&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;table(name,ipCidrRange)&amp;#34;&lt;/span> --sort-by&lt;span class="o">=&lt;/span>ipCidrRange
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">done&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Overlap check logic &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">python3 check_ip_overlap.py --vpc-list&lt;span class="o">=&lt;/span>vpc_list.txt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="2-routing-design">2. Routing Design
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Routing table visualization&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">gcloud compute routes list --format&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;table(
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> name,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> destRange,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> nextHopInstance,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> nextHopVpnTunnel,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> nextHopPeering,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> priority
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">)&amp;#34;&lt;/span> --sort-by&lt;span class="o">=&lt;/span>destRange
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Routing loop detection&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./detect_routing_loops.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="3-connection-testing-automation">3. Connection Testing Automation
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="c"># Connection testing automation (Cloud Build)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">steps&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;gcr.io/cloud-builders/gcloud&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">|&lt;/span>&lt;span class="sd">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> # Reachability testing from each VPC
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> for source_vpc in sales-vpc dev-vpc finance-vpc; do
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> for target_service in ad-service dns-service; do
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> echo &amp;#34;Testing $source_vpc -&amp;gt; $target_service&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> gcloud compute ssh test-vm --zone=asia-northeast1-a \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> --project=${source_vpc}-project \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> --command=&amp;#34;nc -zv ${target_service}.internal 389&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> done
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> done&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="operational-considerations">Operational Considerations
&lt;/h3>&lt;h4 id="1-psc-operations-best-practices">1. PSC Operations Best Practices
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">PSC Operations Guidelines&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Monitoring_Targets&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Endpoint connection status&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Service health&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Data transfer volume &amp;amp; costs&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Alert_Settings&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Connection failure rate &amp;gt; 1%&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Response time &amp;gt; 5 seconds&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Monthly cost &amp;gt; 80% of budget&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Regular_Tasks&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Monthly connection status report&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Quarterly cost optimization review&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Semi-annual security audit&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="2-emergency-response-procedures">2. Emergency Response Procedures
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-markdown" data-lang="markdown">&lt;span class="line">&lt;span class="cl">&lt;span class="gu">## PSC Failure Response Flowchart
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">### Level 1: Endpoint Failure
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">&lt;/span>&lt;span class="k">1.&lt;/span> Switch to other endpoints
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">2.&lt;/span> Contact service provider
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">3.&lt;/span> Notify users of impact scope
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">### Level 2: Service Provider Failure
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">&lt;/span>&lt;span class="k">1.&lt;/span> Switch to backup service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">2.&lt;/span> Enable emergency VPC Peering
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">3.&lt;/span> Begin recovery work
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">### Level 3: Complete Failure
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">&lt;/span>&lt;span class="k">1.&lt;/span> Switch back to on-premises environment
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">2.&lt;/span> Execute business continuity plan
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">3.&lt;/span> Request external support
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="summary-escaping-the-illusion-of-easy-connection">Summary: Escaping the Illusion of &amp;ldquo;Easy Connection&amp;rdquo;
&lt;/h2>&lt;h3 id="project-summary">Project Summary
&lt;/h3>&lt;p>&lt;strong>Total damage:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>System outage opportunity loss: ¥15M&lt;/li>
&lt;li>Emergency response work cost: ¥5M&lt;/li>
&lt;li>External consultant fees: ¥3M&lt;/li>
&lt;li>PSC migration costs: ¥2M
&lt;strong>Total: ¥25M&lt;/strong>&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>However, the value gained:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>Mastering correct network design: Priceless&lt;/li>
&lt;li>Deep understanding of PSC technology: Priceless&lt;/li>
&lt;li>Improved team cohesion: Priceless&lt;/li>
&lt;li>Enhanced incident response capability: Priceless&lt;/li>
&lt;/ul>
&lt;h3 id="most-important-lessons">Most Important Lessons
&lt;/h3>&lt;h4 id="1-the-danger-of-the-word-easy">1. The Danger of the Word &amp;ldquo;Easy&amp;rdquo;
&lt;/h4>&lt;p>&lt;strong>Typical engineer assumption:&lt;/strong>
&amp;ldquo;VPC Peering just connects with a few clicks → Easy&amp;rdquo;&lt;/p>
&lt;p>&lt;strong>Reality:&lt;/strong>
Network design requires multi-layered consideration of IP address design, routing design, security design, and operational design.&lt;/p>
&lt;h4 id="2-importance-of-appropriate-technology-selection">2. Importance of Appropriate Technology Selection
&lt;/h4>&lt;p>&lt;strong>Technology selection principles:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>Accurately understand requirements&lt;/li>
&lt;li>Deeply understand each technology&amp;rsquo;s characteristics&lt;/li>
&lt;li>Consider long-term operational costs&lt;/li>
&lt;li>Prioritize scalability &amp;amp; maintainability&lt;/li>
&lt;/ul>
&lt;h4 id="3-value-of-phased-implementation-and-testing">3. Value of Phased Implementation and Testing
&lt;/h4>&lt;p>&lt;strong>This failure&amp;rsquo;s cause:&lt;/strong>
Connecting all VPCs at once and testing operation&lt;/p>
&lt;p>&lt;strong>Correct approach:&lt;/strong>
Build VPC by VPC in phases, thoroughly testing each phase&lt;/p>
&lt;h3 id="message-to-other-engineers">Message to Other Engineers
&lt;/h3>&lt;p>Network design often appears &amp;ldquo;easy,&amp;rdquo; but it&amp;rsquo;s actually very deep, and once you make design mistakes, it&amp;rsquo;s a difficult area to correct.&lt;/p>
&lt;p>&lt;strong>My 3 pieces of advice:&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>
&lt;p>&lt;strong>Stop and think when something seems &amp;ldquo;easy&amp;rdquo;&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>Question if it&amp;rsquo;s really easy&lt;/li>
&lt;li>Check for hidden complexity&lt;/li>
&lt;li>Consider phased approaches&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Make technology choices based on requirements&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>Don&amp;rsquo;t choose based on trends or apparent simplicity&lt;/li>
&lt;li>Consider long-term operations&lt;/li>
&lt;li>Compare multiple options&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Don&amp;rsquo;t fear learning from failures&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>Failures are the best learning opportunities&lt;/li>
&lt;li>Share knowledge across the entire team&lt;/li>
&lt;li>Create systems to prevent the same failures&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;p>I hope this article serves as a reference for engineers facing similar design decisions.&lt;/p>
&lt;p>And even if you make similar mistakes, I believe that by continuing to improve without giving up, you can surely reach better solutions.&lt;/p>
&lt;hr>
&lt;p>&lt;strong>Related articles:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://firebird-techtalktech.com/tags/gcp/" >GCP Network Design Best Practices&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://firebird-techtalktech.com/tags/psc/" >Private Service Connect Deep Dive&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://firebird-techtalktech.com/categories/incident-response/" >Practical Network Incident Response Methods&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>Note:&lt;/strong> This article is based on actual network incident experience, but specific organization names and system details have been anonymized.&lt;/p></description></item></channel></rss>