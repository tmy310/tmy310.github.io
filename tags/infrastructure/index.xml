<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Infrastructure on firebirdテクテクテクブログ</title><link>https://firebird-techtalktech.com/tags/infrastructure/</link><description>Recent content in Infrastructure on firebirdテクテクテクブログ</description><generator>Hugo -- gohugo.io</generator><language>ja</language><copyright>トミー</copyright><lastBuildDate>Thu, 18 Sep 2025 12:00:00 +0900</lastBuildDate><atom:link href="https://firebird-techtalktech.com/tags/infrastructure/index.xml" rel="self" type="application/rss+xml"/><item><title>GCP上でPacker×Terraformを使ってWindows Serverイメージを作成・展開する方法</title><link>https://firebird-techtalktech.com/post/gcp%E4%B8%8A%E3%81%A7packerterraform%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6windows-server%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8%E3%82%92%E4%BD%9C%E6%88%90%E5%B1%95%E9%96%8B%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95/</link><pubDate>Thu, 18 Sep 2025 12:00:00 +0900</pubDate><guid>https://firebird-techtalktech.com/post/gcp%E4%B8%8A%E3%81%A7packerterraform%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6windows-server%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8%E3%82%92%E4%BD%9C%E6%88%90%E5%B1%95%E9%96%8B%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95/</guid><description>&lt;h2 id="はじめに">はじめに
&lt;/h2>&lt;p>クラウド環境でWindows Serverを運用する際、毎回手動で環境を構築していては時間がかかり、再現性も低くなってしまいます。特にGCP（Google Cloud Platform）上で企業のセキュリティポリシーに準拠したWindows Server環境を構築する場合、以下のような課題に直面することが多いです：&lt;/p>
&lt;ul>
&lt;li>毎回GUIで環境を作ると設定ミスが発生しやすい&lt;/li>
&lt;li>標準イメージでは必要なツールやセキュリティ設定が不足している&lt;/li>
&lt;li>複数環境（開発、検証、本番）で一貫性を保つのが困難&lt;/li>
&lt;li>セキュリティパッチや企業ポリシーの適用が煩雑&lt;/li>
&lt;/ul>
&lt;p>本記事では、&lt;strong>Packer&lt;/strong>と&lt;strong>Terraform&lt;/strong>を組み合わせて、これらの課題を解決する自動化ソリューションを詳細に解説します。&lt;/p>
&lt;h2 id="環境構成とアーキテクチャ">環境構成とアーキテクチャ
&lt;/h2>&lt;h3 id="全体構成図">全体構成図
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ Developer │ │ CI/CD │ │ GCP Project │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ Local │ │ Pipeline │ │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─────────────────┤ ├─────────────────┤ ├─────────────────┤
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ • Packer HCL │───▶│ • GitHub Actions│───▶│ • Custom Images │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ • Terraform │ │ • Cloud Build │ │ • VM Instances │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ • gcloud CLI │ │ • Auto Deploy │ │ • IAM/Network │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─────────────────┘ └─────────────────┘ └─────────────────┘
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="技術スタック">技術スタック
&lt;/h3>&lt;ul>
&lt;li>&lt;strong>Packer 1.9+&lt;/strong>: Windows Serverのカスタムイメージビルド&lt;/li>
&lt;li>&lt;strong>Terraform 1.5+&lt;/strong>: インフラストラクチャのコード管理&lt;/li>
&lt;li>&lt;strong>GCP Compute Engine&lt;/strong>: 実行基盤&lt;/li>
&lt;li>&lt;strong>PowerShell/cmd&lt;/strong>: Windows環境のプロビジョニング&lt;/li>
&lt;li>&lt;strong>WinRM&lt;/strong>: Packerとの通信プロトコル&lt;/li>
&lt;/ul>
&lt;h2 id="事前準備">事前準備
&lt;/h2>&lt;h3 id="1-gcpプロジェクトの設定">1. GCPプロジェクトの設定
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># プロジェクト設定&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">PROJECT_ID&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;your-project-id&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">gcloud config &lt;span class="nb">set&lt;/span> project &lt;span class="nv">$PROJECT_ID&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 必要なAPIの有効化&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">gcloud services &lt;span class="nb">enable&lt;/span> compute.googleapis.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">gcloud services &lt;span class="nb">enable&lt;/span> cloudresourcemanager.googleapis.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">gcloud services &lt;span class="nb">enable&lt;/span> iam.googleapis.com
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="2-サービスアカウントの作成">2. サービスアカウントの作成
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Packer用サービスアカウント作成&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">gcloud iam service-accounts create packer-builder &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --description&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Packer image builder&amp;#34;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --display-name&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Packer Builder&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 必要な権限の付与&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">gcloud projects add-iam-policy-binding &lt;span class="nv">$PROJECT_ID&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --member&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;serviceAccount:packer-builder@&lt;/span>&lt;span class="nv">$PROJECT_ID&lt;/span>&lt;span class="s2">.iam.gserviceaccount.com&amp;#34;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --role&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;roles/compute.instanceAdmin.v1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="packerの詳細設定">Packerの詳細設定
&lt;/h2>&lt;h3 id="メインのpacker設定ファイル">メインのPacker設定ファイル
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-hcl" data-lang="hcl">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># windows-2022.pkr.hcl
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">packer&lt;/span> {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">required_plugins&lt;/span> {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> googlecompute&lt;/span> &lt;span class="o">=&lt;/span> {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> version&lt;/span> &lt;span class="o">=&lt;/span>&lt;span class="n"> &amp;#34;&amp;gt;&lt;/span>&lt;span class="o">=&lt;/span> &lt;span class="m">1&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="err">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> source&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;github.com/hashicorp/googlecompute&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">variable&lt;/span> &lt;span class="s2">&amp;#34;project_id&amp;#34;&lt;/span> {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> type&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">string&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> description&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;GCP Project ID&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">variable&lt;/span> &lt;span class="s2">&amp;#34;zone&amp;#34;&lt;/span> {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> type&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">string&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> default&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;asia-northeast1-b&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> description&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;GCP Zone for building&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">source&lt;/span> &lt;span class="s2">&amp;#34;googlecompute&amp;#34; &amp;#34;windows-2022&amp;#34;&lt;/span> {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> project_id&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">var&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">project_id&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> source_image_family&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;windows-2022&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> zone&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">var&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">zone&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> machine_type&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;e2-standard-4&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> disk_size&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="m">50&lt;/span>&lt;span class="c1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"> # Windows固有の設定
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n"> communicator&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;winrm&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> winrm_username&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;packer_user&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> winrm_password&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;SecurePassword123!&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> winrm_timeout&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;30m&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> winrm_use_ssl&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kt">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> winrm_insecure&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kt">true&lt;/span>&lt;span class="c1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"> # イメージ設定
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n"> image_name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;custom-windows-2022-{{timestamp}}&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> image_description&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;Custom Windows Server 2022 with security baseline&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> image_family&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;custom-windows-2022&amp;#34;&lt;/span>&lt;span class="c1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"> # タグとラベル
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n"> tags&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;packer&amp;#34;, &amp;#34;windows&amp;#34;, &amp;#34;base-image&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">build&lt;/span> {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;windows-2022-custom&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> sources&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;source.googlecompute.windows-2022&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"> # Windows Updateの実行
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">provisioner&lt;/span> &lt;span class="s2">&amp;#34;powershell&amp;#34;&lt;/span> {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> script&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;scripts/windows-update.ps1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }&lt;span class="c1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"> # 必要なツールのインストール
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">provisioner&lt;/span> &lt;span class="s2">&amp;#34;powershell&amp;#34;&lt;/span> {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> script&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;scripts/install-tools.ps1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }&lt;span class="c1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"> # セキュリティベースラインの適用
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">provisioner&lt;/span> &lt;span class="s2">&amp;#34;powershell&amp;#34;&lt;/span> {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> script&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;scripts/security-baseline.ps1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }&lt;span class="c1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"> # クリーンアップ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">provisioner&lt;/span> &lt;span class="s2">&amp;#34;powershell&amp;#34;&lt;/span> {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> script&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;scripts/cleanup.ps1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="terraformによる自動展開">Terraformによる自動展開
&lt;/h2>&lt;h3 id="メインのterraform設定">メインのTerraform設定
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-hcl" data-lang="hcl">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># main.tf
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">terraform&lt;/span> {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> required_version&lt;/span> &lt;span class="o">=&lt;/span>&lt;span class="n"> &amp;#34;&amp;gt;&lt;/span>&lt;span class="o">=&lt;/span> &lt;span class="m">1&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="m">5&lt;/span>&lt;span class="err">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">required_providers&lt;/span> {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> google&lt;/span> &lt;span class="o">=&lt;/span> {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> source&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;hashicorp/google&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> version&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;~&amp;gt; 4.84&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">provider&lt;/span> &lt;span class="s2">&amp;#34;google&amp;#34;&lt;/span> {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> project&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">var&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">project_id&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> region&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">var&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">region&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> zone&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">var&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">zone&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}&lt;span class="c1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># データソース: 最新のカスタムイメージを取得
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">data&lt;/span> &lt;span class="s2">&amp;#34;google_compute_image&amp;#34; &amp;#34;windows_image&amp;#34;&lt;/span> {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> family&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;custom-windows-2022&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> project&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">var&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">project_id&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}&lt;span class="c1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Windows VM インスタンス
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">resource&lt;/span> &lt;span class="s2">&amp;#34;google_compute_instance&amp;#34; &amp;#34;windows_vm&amp;#34;&lt;/span> {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">var&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">instance_name&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> machine_type&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">var&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">machine_type&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> zone&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">var&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">zone&lt;/span>&lt;span class="c1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"> # ブートディスク
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">boot_disk&lt;/span> {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">initialize_params&lt;/span> {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> image&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">data&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">google_compute_image&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">windows_image&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">self_link&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> size&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">var&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">disk_size&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> type&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;pd-standard&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }&lt;span class="c1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"> # ネットワーク設定
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">network_interface&lt;/span> {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> network&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">var&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">network&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> subnetwork&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">var&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">subnetwork&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">access_config&lt;/span> {}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }&lt;span class="c1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"> # メタデータ（ユーザー作成等）
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n"> metadata&lt;/span> &lt;span class="o">=&lt;/span> {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> windows-startup-script-ps1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">templatefile&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;${path.module}/scripts/startup.ps1&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> admin_username&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">var&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">admin_username&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> admin_password&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">var&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">admin_password&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }&lt;span class="c1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"> # タグ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n"> tags&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;windows-server&amp;#34;, &amp;#34;rdp-server&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="実行手順">実行手順
&lt;/h2>&lt;h3 id="1-packerでイメージビルド">1. Packerでイメージビルド
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 変数ファイルの作成&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cat &amp;gt; variables.pkrvars.hcl &lt;span class="s">&amp;lt;&amp;lt; EOF
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">project_id = &amp;#34;your-project-id&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># イメージのビルド実行&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">packer build -var-file&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;variables.pkrvars.hcl&amp;#34;&lt;/span> windows-2022.pkr.hcl
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="2-terraformで展開">2. Terraformで展開
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 作業ディレクトリの初期化&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> terraform
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">terraform init
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 実行プランの確認&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">terraform plan -var-file&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;terraform.tfvars&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># リソースの作成&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">terraform apply -var-file&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;terraform.tfvars&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="トラブルシューティング">トラブルシューティング
&lt;/h2>&lt;h3 id="よくある問題と解決方法">よくある問題と解決方法
&lt;/h3>&lt;h4 id="1-winrm接続エラー">1. WinRM接続エラー
&lt;/h4>&lt;p>&lt;strong>問題&lt;/strong>: Packerビルド中にWinRMでの接続が失敗する&lt;/p>
&lt;p>&lt;strong>解決方法&lt;/strong>:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-powershell" data-lang="powershell">&lt;span class="line">&lt;span class="cl">&lt;span class="c"># メタデータでWinRMを確実に有効化&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">winrm&lt;/span> &lt;span class="n">quickconfig&lt;/span> &lt;span class="n">-quiet&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">winrm&lt;/span> &lt;span class="nb">set &lt;/span>&lt;span class="n">winrm&lt;/span>&lt;span class="p">/&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="p">/&lt;/span>&lt;span class="n">service&lt;/span> &lt;span class="vm">@&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">AllowUnencrypted&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="s2">&amp;#34;true&amp;#34;&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">winrm&lt;/span> &lt;span class="nb">set &lt;/span>&lt;span class="n">winrm&lt;/span>&lt;span class="p">/&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="p">/&lt;/span>&lt;span class="n">service&lt;/span>&lt;span class="p">/&lt;/span>&lt;span class="n">auth&lt;/span> &lt;span class="vm">@&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">Basic&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="s2">&amp;#34;true&amp;#34;&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="2-ファイアウォールブロック">2. ファイアウォールブロック
&lt;/h4>&lt;p>&lt;strong>問題&lt;/strong>: RDPやWinRMポートがブロックされる&lt;/p>
&lt;p>&lt;strong>解決方法&lt;/strong>:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># GCPファイアウォールルールの確認&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">gcloud compute firewall-rules list --filter&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;name~allow-rdp&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 必要に応じてルールを作成&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">gcloud compute firewall-rules create allow-rdp-custom &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --allow tcp:3389 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --source-ranges 0.0.0.0/0 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --target-tags rdp-server
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="セキュリティ考慮事項">セキュリティ考慮事項
&lt;/h2>&lt;h3 id="認証情報の管理">認証情報の管理
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Secret Manager にパスワードを保存&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">gcloud secrets create windows-admin-password --data-file&lt;span class="o">=&lt;/span>-
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Terraform で Secret Manager から取得&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">data &lt;span class="s2">&amp;#34;google_secret_manager_secret_version&amp;#34;&lt;/span> &lt;span class="s2">&amp;#34;admin_password&amp;#34;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">secret&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;windows-admin-password&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="まとめ">まとめ
&lt;/h2>&lt;p>本記事では、GCP上でPackerとTerraformを組み合わせてWindows Serverの自動化ソリューションを構築する方法を詳細に解説しました。&lt;/p>
&lt;h3 id="主な利点">主な利点
&lt;/h3>&lt;ol>
&lt;li>&lt;strong>再現性&lt;/strong>: 毎回同一の環境を構築可能&lt;/li>
&lt;li>&lt;strong>効率性&lt;/strong>: 手動作業を大幅に削減&lt;/li>
&lt;li>&lt;strong>セキュリティ&lt;/strong>: セキュリティベースラインを自動適用&lt;/li>
&lt;li>&lt;strong>スケーラビリティ&lt;/strong>: 複数環境への横展開が容易&lt;/li>
&lt;li>&lt;strong>監査性&lt;/strong>: インフラの変更履歴をコードで管理&lt;/li>
&lt;/ol>
&lt;p>この自動化基盤により、Windows Server環境の構築・運用が劇的に効率化されることを実感していただけるでしょう。&lt;/p>
&lt;p>次回は、セキュリティベースライン適用時の注意点について詳しく解説します。&lt;/p></description></item><item><title>[Migration Hell] Complete Record of 6-Month GCP Migration Disaster: From 20-Year Physical Network to Cloud</title><link>https://firebird-techtalktech.com/post/migration-hell-complete-record-of-6-month-gcp-migration-disaster-from-20-year-physical-network-to-cloud/</link><pubDate>Sun, 14 Sep 2025 16:00:00 +0900</pubDate><guid>https://firebird-techtalktech.com/post/migration-hell-complete-record-of-6-month-gcp-migration-disaster-from-20-year-physical-network-to-cloud/</guid><description>&lt;h1 id="migration-hell-complete-record-of-6-month-gcp-migration-disaster-from-20-year-physical-network-to-cloud">[Migration Hell] Complete Record of 6-Month GCP Migration Disaster: From 20-Year Physical Network to Cloud
&lt;/h1>&lt;h2 id="prologue-the-naive-view-of-cloud-migration">Prologue: The Naive View of Cloud Migration
&lt;/h2>&lt;p>&lt;strong>Monday, January 15, 2025, 10:00 AM&lt;/strong>&lt;/p>
&lt;p>&amp;ldquo;Migrating from physical network to cloud? That&amp;rsquo;s easy. Create a VPC, set up subnets, spin up VM instances. Three months is more than enough time.&amp;rdquo;&lt;/p>
&lt;p>I confidently declared this in front of the executive team. Little did I know that I would witness six months of hell following that statement.&lt;/p>
&lt;p>This is the blood, sweat, and tears record of a disastrous attempt to migrate a 20-year legacy physical network to GCP.&lt;/p>
&lt;h2 id="chapter-1-20-years-of-technical-debt---the-reality">Chapter 1: &amp;ldquo;20 Years of Technical Debt&amp;rdquo; - The Reality
&lt;/h2>&lt;h3 id="migration-target-unimaginably-complex-legacy-environment">Migration Target: Unimaginably Complex Legacy Environment
&lt;/h3>&lt;p>What we were attempting to migrate was a physical network that had been continuously expanded over 20 years since the company&amp;rsquo;s founding.&lt;/p>
&lt;p>&lt;strong>Head Office Configuration (280 employees):&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Internet (Multiple Lines)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ↓
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[Ancient Cisco Router] 192.168.1.1 (Manufactured in 2005)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ↓
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[L2 Switch Cascade]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├─ Sales Dept: 192.168.10.0/24 (50 devices)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├─ Development Dept: 192.168.20.0/24 (80 devices)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├─ Accounting Dept: 192.168.30.0/24 (30 devices)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├─ HR Dept: 192.168.40.0/24 (40 devices)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├─ Servers: 192.168.100.0/24 (15 devices)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> └─ Printers/Others: 192.168.200.0/24 (35 devices)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>3 Branch Offices:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>Osaka Branch (50 employees)&lt;/li>
&lt;li>Fukuoka Branch (30 employees)&lt;/li>
&lt;li>Sapporo Branch (25 employees)&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>2 Manufacturing Plants:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>Chiba Plant (Production Line Control Systems)&lt;/li>
&lt;li>Gunma Plant (Quality Management Systems)&lt;/li>
&lt;/ul>
&lt;p>&amp;ldquo;Just move this to the cloud, right? Piece of cake!&amp;rdquo;&lt;/p>
&lt;h3 id="january-16-first-shock">January 16: First Shock
&lt;/h3>&lt;p>When we actually started detailed investigation of the existing environment, I was horrified.&lt;/p>
&lt;p>&lt;strong>Discovered Problem Categories:&lt;/strong>&lt;/p>
&lt;h4 id="1-chaotic-network-design">1. Chaotic Network Design
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Actual routing table&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route show
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">192.168.10.0/24 via 192.168.1.10 # Sales (Why different gateway?)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.20.0/24 via 192.168.1.1 # Development (Standard)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.30.0/24 via 192.168.1.15 # Accounting (Different again)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.40.0/24 via 192.168.1.1 # HR (Standard)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.100.0/24 via 192.168.1.20 # Servers (Different again)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&amp;ldquo;Why does each department have a different gateway&amp;hellip;?&amp;rdquo;&lt;/p>
&lt;h4 id="2-legacy-system-dependencies">2. Legacy System Dependencies
&lt;/h4>&lt;p>&lt;strong>Production Line Control System (Chiba Plant):&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>OS: Windows Server 2003 (End-of-life)&lt;/li>
&lt;li>Application: Custom software written in Visual Basic 6.0&lt;/li>
&lt;li>Communication: Hardcoded to specific IP address (192.168.100.5)&lt;/li>
&lt;li>Vendor: Bankrupt 10 years ago&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>Quality Management System (Gunma Plant):&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>OS: Red Hat Enterprise Linux 4 (Ancient)&lt;/li>
&lt;li>Database: Oracle 9i (Also ancient)&lt;/li>
&lt;li>Network: Only works with fixed IP addresses&lt;/li>
&lt;li>Documentation: None&lt;/li>
&lt;/ul>
&lt;p>&amp;ldquo;Can we even migrate this&amp;hellip;?&amp;rdquo;&lt;/p>
&lt;h4 id="3-mysterious-custom-systems">3. Mysterious Custom Systems
&lt;/h4>&lt;p>Twenty years of retired IT staff had created numerous &amp;ldquo;secret sauce&amp;rdquo; systems scattered throughout the infrastructure.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Discovered mysterious cron jobs&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">crontab -l
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">0&lt;/span> &lt;span class="m">2&lt;/span> * * * /home/legacy/mystery_sync.sh &amp;gt;&amp;gt; /dev/null 2&amp;gt;&lt;span class="p">&amp;amp;&lt;/span>&lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">30&lt;/span> &lt;span class="m">3&lt;/span> * * * /usr/local/bin/old_backup.pl 192.168.100.10
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>Contents of mystery_sync.sh:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>&lt;span class="c1"># Creator unknown, creation date unknown&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Don&amp;#39;t know what it does, but something breaks if we stop it&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rsync -av 192.168.100.5:/mysterious/data/ 192.168.100.10:/backup/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="o">[&lt;/span> &lt;span class="nv">$?&lt;/span> -eq &lt;span class="m">0&lt;/span> &lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;Success&amp;#34;&lt;/span> &lt;span class="p">|&lt;/span> mail -s &lt;span class="s2">&amp;#34;Daily Sync&amp;#34;&lt;/span> someone@company.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">else&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Do nothing on failure (why?)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">exit&lt;/span> &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&amp;ldquo;Who created this&amp;hellip;? What is this script for&amp;hellip;?&amp;rdquo;&lt;/p>
&lt;h3 id="january-20-submission-of-migration-plan">January 20: Submission of Migration Plan
&lt;/h3>&lt;p>Report to supervisor:&lt;/p>
&lt;p>&amp;ldquo;After investigating the target systems, they&amp;rsquo;re more complex than expected. I&amp;rsquo;d like to extend the migration period to 6 months.&amp;rdquo;&lt;/p>
&lt;p>Supervisor: &amp;ldquo;What are you talking about? You promised 3 months. We need to start the new fiscal year with the new system on April 1st.&amp;rdquo;&lt;/p>
&lt;p>&amp;ldquo;But the legacy systems are&amp;hellip;&amp;rdquo;&lt;/p>
&lt;p>Supervisor: &amp;ldquo;Stop making excuses. Figure out how to make it work.&amp;rdquo;&lt;/p>
&lt;p>&lt;strong>My desperate decision under pressure: &amp;ldquo;Forklift Migration&amp;rdquo;&lt;/strong>&lt;/p>
&lt;h2 id="chapter-2-february-optimism---the-small-scale-trap">Chapter 2: February Optimism - The Small-Scale Trap
&lt;/h2>&lt;h3 id="migration-strategy-phased-approach">Migration Strategy: Phased Approach
&lt;/h3>&lt;p>At least attempting a phased migration, I established the following plan:&lt;/p>
&lt;p>&lt;strong>Phase 1 (February)&lt;/strong>: Sapporo Branch (25 people, minimal configuration)
&lt;strong>Phase 2 (March)&lt;/strong>: Osaka &amp;amp; Fukuoka Branches (80 people)
&lt;strong>Phase 3 (Late March)&lt;/strong>: Head Office (280 people)
&lt;strong>Phase 4 (April)&lt;/strong>: Plant Systems (Ultimate challenge)&lt;/p>
&lt;p>&amp;ldquo;Starting small should mean small problems.&amp;rdquo;&lt;/p>
&lt;h3 id="february-5-sapporo-branch-migration-begins">February 5: Sapporo Branch Migration Begins
&lt;/h3>&lt;p>&lt;strong>Sapporo Branch Existing Configuration:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[Router] 192.168.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─[Switch]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├─ PCs: 192.168.1.100-125 (25 devices)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├─ Server: 192.168.1.10 (File server)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> └─ Printers: 192.168.1.200-202 (3 devices)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>GCP Post-Migration Design:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">Project&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">company-sapporo&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">VPC&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">sapporo-vpc (10.1.0.0/16)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Subnets&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">office-subnet&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">10.1.1.0&lt;/span>&lt;span class="l">/24&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">Compute Engine&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">10.1.1.10-50&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">server-subnet&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">10.1.2.0&lt;/span>&lt;span class="l">/24 &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">File Server VM&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">10.1.2.10&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&amp;ldquo;Simple and clean design. This should be quick.&amp;rdquo;&lt;/p>
&lt;h3 id="february-10-first-landmine">February 10: First Landmine
&lt;/h3>&lt;p>Day 5 of migration work, the first major problem occurred.&lt;/p>
&lt;p>&lt;strong>9 AM emergency call from Sapporo Branch:&lt;/strong>&lt;/p>
&lt;p>&amp;ldquo;We can&amp;rsquo;t access the file server! We can&amp;rsquo;t work!&amp;rdquo;&lt;/p>
&lt;p>&lt;strong>Investigation revealed the problem:&lt;/strong>&lt;/p>
&lt;h4 id="1-active-directory-domain-dependencies">1. Active Directory Domain Dependencies
&lt;/h4>&lt;p>The Sapporo file server was dependent on the Tokyo head office Active Directory domain controller.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Tokyo HQ DC: 192.168.100.10 (Physical)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ↓ (Domain authentication via VPN)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sapporo File Server: 192.168.1.10 → 10.1.2.10 (Migrated to GCP)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>Problems:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>GCP file server cannot connect to physical DC (192.168.100.10)&lt;/li>
&lt;li>VPN configuration doesn&amp;rsquo;t support Active Directory authentication&lt;/li>
&lt;li>No authentication = all users cannot access files&lt;/li>
&lt;/ul>
&lt;h4 id="2-fixed-ip-address-dependencies">2. Fixed IP Address Dependencies
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Shared drives configured on each PC in Sapporo branch&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">net use Z: &lt;span class="se">\\&lt;/span>192.168.1.10&lt;span class="se">\s&lt;/span>hared /persistent:yes
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>Problems:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>All PCs have shared drives hardcoded to 192.168.1.10&lt;/li>
&lt;li>Need to change to new IP (10.1.2.10) on 25 devices manually&lt;/li>
&lt;li>No DNS setup, can&amp;rsquo;t resolve names&lt;/li>
&lt;/ul>
&lt;h4 id="3-bizarrely-complex-printer-dependencies">3. Bizarrely Complex Printer Dependencies
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Mysterious printer management system&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cat /etc/cups/printers.conf
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Incredibly, the Sapporo printer configuration was managed by a printer management server in Tokyo (192.168.100.15).&lt;/p>
&lt;p>&lt;strong>Dependency chain:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">Sapporo&lt;/span> &lt;span class="n">PC&lt;/span> &lt;span class="err">→&lt;/span> &lt;span class="n">Sapporo&lt;/span> &lt;span class="n">Printer&lt;/span> &lt;span class="n">Configuration&lt;/span> &lt;span class="n">Request&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="err">↓&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Tokyo&lt;/span> &lt;span class="n">Printer&lt;/span> &lt;span class="n">Management&lt;/span> &lt;span class="n">Server&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">100.15&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="err">↓&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Download&lt;/span> &lt;span class="n">Configuration&lt;/span> &lt;span class="err">→&lt;/span> &lt;span class="n">Sapporo&lt;/span> &lt;span class="n">PC&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="err">↓&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Execute&lt;/span> &lt;span class="n">Print&lt;/span> &lt;span class="n">on&lt;/span> &lt;span class="n">Sapporo&lt;/span> &lt;span class="n">Printer&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.200&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&amp;ldquo;Why do Sapporo printers depend on a Tokyo server&amp;hellip;?&amp;rdquo;&lt;/p>
&lt;h3 id="february-12-emergency-recovery-work">February 12: Emergency Recovery Work
&lt;/h3>&lt;p>&lt;strong>Weekend emergency response:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 1. Emergency VPN setup&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">gcloud compute vpn-gateways create sapporo-to-tokyo &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --region&lt;span class="o">=&lt;/span>asia-northeast1 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --network&lt;span class="o">=&lt;/span>sapporo-vpc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 2. Temporary DNS configuration&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;10.1.2.10 fileserver.company.local&amp;#34;&lt;/span> &amp;gt;&amp;gt; /etc/hosts
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 3. Change settings on all PCs manually (25 devices)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Run on each PC:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">net use Z: /delete
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">net use Z: &lt;span class="se">\\&lt;/span>10.1.2.10&lt;span class="se">\s&lt;/span>hared
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>Results:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>2 days of all-night work&lt;/li>
&lt;li>Sapporo branch resumed normal operations Monday morning&lt;/li>
&lt;li>However, printer problems remain unsolved&lt;/li>
&lt;/ul>
&lt;p>&amp;ldquo;Even a small branch office is this difficult&amp;hellip;&amp;rdquo;&lt;/p>
&lt;h2 id="chapter-3-march-collapse---explosion-of-complexity">Chapter 3: March Collapse - Explosion of Complexity
&lt;/h2>&lt;h3 id="march-1-simultaneous-migration-of-osaka--fukuoka-branches">March 1: Simultaneous Migration of Osaka &amp;amp; Fukuoka Branches
&lt;/h3>&lt;p>Learning from Sapporo experience, this time we conducted thorough advance investigation.&lt;/p>
&lt;p>&lt;strong>Osaka Branch (50 people) discovered complexity:&lt;/strong>&lt;/p>
&lt;h4 id="1-complex-inter-department-vlan-configuration">1. Complex Inter-Department VLAN Configuration
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Osaka branch VLAN configuration&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vlan 10: Sales &lt;span class="o">(&lt;/span>192.168.10.0/24&lt;span class="o">)&lt;/span> - &lt;span class="m">30&lt;/span> devices
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vlan 20: Technical &lt;span class="o">(&lt;/span>192.168.20.0/24&lt;span class="o">)&lt;/span> - &lt;span class="m">15&lt;/span> devices
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vlan 30: Management &lt;span class="o">(&lt;/span>192.168.30.0/24&lt;span class="o">)&lt;/span> - &lt;span class="m">5&lt;/span> devices
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Inter-department communication restrictions&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Sales → Technical: HTTP/HTTPS only&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Technical → Sales: All denied&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Management → All departments: All allowed&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># All departments → Management: Specific ports only&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>Problem:&lt;/strong>
Need to reproduce this complex VLAN inter-communication control with GCP VPC firewall rules.&lt;/p>
&lt;h4 id="2-mysterious-business-systems">2. Mysterious Business Systems
&lt;/h4>&lt;p>&lt;strong>Osaka-specific Customer Management System:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>Development language: Visual Basic 6.0&lt;/li>
&lt;li>Database: Microsoft Access (.mdb format)&lt;/li>
&lt;li>Network: Specific shared folder (\192.168.10.5\database)&lt;/li>
&lt;li>Creator: Veteran employee who retired 10 years ago&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-vb" data-lang="vb">&lt;span class="line">&lt;span class="cl">&lt;span class="c">&amp;#39; Actual VB6 code (partial)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span>&lt;span class="k">Private&lt;/span> &lt;span class="k">Sub&lt;/span> &lt;span class="nf">ConnectToDatabase&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">Dim&lt;/span> &lt;span class="n">dbPath&lt;/span> &lt;span class="ow">As&lt;/span> &lt;span class="kt">String&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">dbPath&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;\\192.168.10.5\database\customer.mdb&amp;#34;&lt;/span> &lt;span class="c">&amp;#39; Hardcoded!
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">Set&lt;/span> &lt;span class="n">db&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">OpenDatabase&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">dbPath&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">If&lt;/span> &lt;span class="n">db&lt;/span> &lt;span class="ow">Is&lt;/span> &lt;span class="k">Nothing&lt;/span> &lt;span class="k">Then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MsgBox&lt;/span> &lt;span class="s">&amp;#34;Cannot connect to database&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">vbCritical&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">End&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">End&lt;/span> &lt;span class="k">If&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">End&lt;/span> &lt;span class="k">Sub&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&amp;ldquo;IP addresses hardcoded&amp;hellip; and it&amp;rsquo;s an Access file&amp;hellip;&amp;rdquo;&lt;/p>
&lt;h4 id="3-fukuoka-branch-independent-kingdom-problem">3. Fukuoka Branch &amp;ldquo;Independent Kingdom&amp;rdquo; Problem
&lt;/h4>&lt;p>&lt;strong>March 5, investigation of Fukuoka branch revealed the truth:&lt;/strong>&lt;/p>
&lt;p>Fukuoka branch had a completely independent network design from other locations.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Fukuoka Branch Independent System:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Independent domain: fukuoka.local (separate from HQ)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Independent Active Directory: fukuoka-dc.fukuoka.local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Independent mail server: mail.fukuoka.local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Independent file server: files.fukuoka.local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Independent business system: sales.fukuoka.local
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>Why did this happen?&lt;/strong>&lt;/p>
&lt;p>In 2018, when Fukuoka branch became an independent profit center, the branch manager decided they &amp;ldquo;didn&amp;rsquo;t want to depend on HQ systems&amp;rdquo; and built a completely independent system.&lt;/p>
&lt;p>&lt;strong>Problems:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>Fukuoka branch requires completely different migration method&lt;/li>
&lt;li>No consistency with integrated GCP project design&lt;/li>
&lt;li>User management and permission management also independent&lt;/li>
&lt;/ul>
&lt;p>&amp;ldquo;This isn&amp;rsquo;t migration, it&amp;rsquo;s new construction&amp;hellip;&amp;rdquo;&lt;/p>
&lt;h3 id="march-15-multi-site-migration-nightmare">March 15: Multi-Site Migration Nightmare
&lt;/h3>&lt;p>&lt;strong>Results of forcing it in 1 month preparation period:&lt;/strong>&lt;/p>
&lt;h4 id="migration-day-timeline">Migration Day Timeline
&lt;/h4>&lt;p>&lt;strong>9:00 AM: Migration begins&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Create Osaka branch VPC&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">gcloud compute networks create osaka-vpc --subnet-mode&lt;span class="o">=&lt;/span>custom
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Create Fukuoka branch VPC &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">gcloud compute networks create fukuoka-vpc --subnet-mode&lt;span class="o">=&lt;/span>custom
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>11:00 AM: First trouble&lt;/strong>
Mistake in Osaka branch VLAN inter-communication control rules. Sales department communication to technical department completely blocked.&lt;/p>
&lt;p>&lt;strong>1:00 PM: Data migration errors multiply&lt;/strong>
Data migration of Osaka customer management system (VB6 + Access) suffers multiple character encoding errors.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">ERROR: Invalid character encoding in customer.mdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ERROR: Record corruption detected in table [Customer Master]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ERROR: Primary key violation in [Sales History]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>3:00 PM: Fukuoka branch authentication system completely down&lt;/strong>
Configuration error in independent Active Directory migration. All users cannot log in.&lt;/p>
&lt;p>&lt;strong>5:00 PM: Emergency rollback decision&lt;/strong>&lt;/p>
&lt;p>Though we wanted to &amp;ldquo;restore everything today,&amp;rdquo; we had to accept reality.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Emergency rollback&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Return Osaka branch to physical environment&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">gcloud compute instances stop osaka-fileserver
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">gcloud compute instances stop osaka-dc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Return Fukuoka branch to physical environment&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">gcloud compute instances stop fukuoka-systems --zone&lt;span class="o">=&lt;/span>asia-northeast1-a
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="march-16-total-attack-from-stakeholders">March 16: Total Attack from Stakeholders
&lt;/h3>&lt;p>&lt;strong>Emergency board meeting called&lt;/strong>&lt;/p>
&lt;p>Executives: &amp;ldquo;Why did the migration fail?&amp;rdquo;&lt;/p>
&lt;p>Me: &amp;ldquo;The existing systems were more complex than expected&amp;hellip;&amp;rdquo;&lt;/p>
&lt;p>Sales Manager: &amp;ldquo;Some customer data in Osaka branch was corrupted. How will you take responsibility?&amp;rdquo;&lt;/p>
&lt;p>Technical Manager: &amp;ldquo;Didn&amp;rsquo;t you know about Fukuoka&amp;rsquo;s independent system beforehand?&amp;rdquo;&lt;/p>
&lt;p>General Affairs Manager: &amp;ldquo;Migration costs have doubled the budget. Explain this.&amp;rdquo;&lt;/p>
&lt;p>&lt;strong>Additional problems discovered:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>230 customer records corrupted during data migration&lt;/li>
&lt;li>Fukuoka branch email system stopped for 12 hours&lt;/li>
&lt;li>Osaka branch payroll system unable to process month-end&lt;/li>
&lt;/ul>
&lt;p>&amp;ldquo;I&amp;rsquo;m completely screwed&amp;hellip;&amp;rdquo;&lt;/p>
&lt;h2 id="chapter-4-april-despair---head-office-migration-catastrophe">Chapter 4: April Despair - Head Office Migration Catastrophe
&lt;/h2>&lt;h3 id="april-1-forced-head-office-migration-at-new-fiscal-year-start">April 1: Forced Head Office Migration at New Fiscal Year Start
&lt;/h3>&lt;p>Executive ultimatum: &amp;ldquo;Complete migration by new fiscal year start. No more delays allowed.&amp;rdquo;&lt;/p>
&lt;p>&lt;strong>Head Office (280 people) Migration Target Systems:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Department Networks:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─ Sales: 192.168.10.0/24 (50 devices)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─ Development: 192.168.20.0/24 (80 devices)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─ Accounting: 192.168.30.0/24 (30 devices)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─ HR: 192.168.40.0/24 (40 devices)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─ Executive: 192.168.50.0/24 (10 devices)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─ Servers: 192.168.100.0/24 (30 devices)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Critical Systems:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─ Active Directory (Windows Server 2012)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─ Exchange Server (Email)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─ SAP ERP (Core business system)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─ Accounting System (Yayoi Accounting Server Edition)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─ HR System (Custom developed)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─ File Server Cluster (5 devices)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="april-1-900-am-migration-begins">April 1, 9:00 AM: Migration Begins
&lt;/h3>&lt;p>&lt;strong>Team Structure:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>Me (Project Leader)&lt;/li>
&lt;li>Network Engineers: 2 people&lt;/li>
&lt;li>System Engineers: 3 people&lt;/li>
&lt;li>External contractors: 5 people&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>Migration Schedule:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>09:00-12:00: System shutdown &amp;amp; data backup&lt;/li>
&lt;li>12:00-15:00: GCP instance creation &amp;amp; configuration&lt;/li>
&lt;li>15:00-18:00: Data migration &amp;amp; system configuration&lt;/li>
&lt;li>18:00-20:00: Operation verification &amp;amp; adjustment&lt;/li>
&lt;li>20:00: New system goes live&lt;/li>
&lt;/ul>
&lt;p>&amp;ldquo;This time we&amp;rsquo;ll succeed!&amp;rdquo;&lt;/p>
&lt;h3 id="april-1-1100-am-first-fatal-problem">April 1, 11:00 AM: First Fatal Problem
&lt;/h3>&lt;p>&lt;strong>Unexpected situation during SAP system migration:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Error during SAP migration work&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SAP System Copy Error:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Cannot connect to database instance
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Network path not found: 192.168.100.20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">License validation failed: Hardware fingerprint changed
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>Discovered problems:&lt;/strong>&lt;/p>
&lt;h4 id="1-sap-license-strict-restrictions">1. SAP License Strict Restrictions
&lt;/h4>&lt;p>The SAP system performed license authentication based on server hardware-specific information (CPU ID, MAC address, etc.).&lt;/p>
&lt;p>&lt;strong>Physical Server:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>CPU ID: Intel-Xeon-E5-2680-v3-12C-24T&lt;/li>
&lt;li>MAC Address: 00:1B:21:A4:32:F8&lt;/li>
&lt;li>License Key: Unique key generated from this information&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>GCP Compute Engine:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>CPU ID: Google-Custom-CPU (virtual)&lt;/li>
&lt;li>MAC Address: 42:01:0A:80:00:XX (dynamic)&lt;/li>
&lt;li>License Key: Completely different from physical server&lt;/li>
&lt;/ul>
&lt;p>&amp;ldquo;SAP license reacquisition needed&amp;hellip; but the process takes 2 weeks&amp;hellip;&amp;rdquo;&lt;/p>
&lt;h4 id="2-mysterious-accounting-system-specifications">2. Mysterious Accounting System Specifications
&lt;/h4>&lt;p>&lt;strong>Yayoi Accounting Server Edition hidden dependencies:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-ini" data-lang="ini">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">; Configuration file (hidden file)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">[Network]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">ServerIP&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">192.168.100.25&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">BackupPath&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">\\192.168.100.30\backup\accounting\&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">TempPath&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">C:\Windows\Temp\Yayoi\&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">PrinterServer&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">192.168.100.35&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">[Security] &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">AllowedClients&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">192.168.30.0/24&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">DenyOtherNetworks&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">TRUE&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">HardwareValidation&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">ENABLED&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>Problems:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>IP addresses hardcoded in numerous locations&lt;/li>
&lt;li>Only connections from accounting department subnet (192.168.30.0/24) allowed&lt;/li>
&lt;li>Hardware authentication also enabled&lt;/li>
&lt;/ul>
&lt;h3 id="april-1-200-pm-cascading-system-failures">April 1, 2:00 PM: Cascading System Failures
&lt;/h3>&lt;p>&lt;strong>Fatal flaw discovered in HR system:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Part of HR system (Python 2.7)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">get_employee_data&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Direct IP specification for database connection&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">conn&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">psycopg2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">connect&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">host&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;192.168.100.40&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1"># PostgreSQL Server&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">port&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">5432&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">database&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;hr_system&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">user&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;hr_user&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">password&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;hr_pass_2019&amp;#34;&lt;/span> &lt;span class="c1"># Old password&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">conn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">print_salary_report&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Direct output to printer server&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">printer_server&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="se">\\\\&lt;/span>&lt;span class="s2">192.168.100.50&lt;/span>&lt;span class="se">\\&lt;/span>&lt;span class="s2">HP_LaserJet_5000&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">system&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;copy salary_report.pdf &lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">printer_server&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>Serious problems discovered:&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>&lt;strong>Python 2.7&lt;/strong>: End-of-life, doesn&amp;rsquo;t exist in GCP images&lt;/li>
&lt;li>&lt;strong>PostgreSQL 8.4&lt;/strong>: Too old for GCP managed services&lt;/li>
&lt;li>&lt;strong>Direct printer connection&lt;/strong>: Direct communication with network printer&lt;/li>
&lt;li>&lt;strong>Hardcode festival&lt;/strong>: Written directly in source code, not configuration files&lt;/li>
&lt;/ol>
&lt;h3 id="april-1-400-pm-company-wide-system-outage">April 1, 4:00 PM: Company-wide System Outage
&lt;/h3>&lt;p>&lt;strong>Error cascade:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">16:00 - SAP ERP stops → Sales &amp;amp; accounting operations halt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">16:15 - Accounting system inaccessible → Accounting department unable to work
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">16:30 - HR system errors → Payroll &amp;amp; attendance management impossible
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">16:45 - Exchange Server migration fails → Company-wide email stops
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">17:00 - File server authentication errors → Shared folder access impossible
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>Situation in the company:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>Sales: &amp;ldquo;Can&amp;rsquo;t handle customers! Quote system unusable!&amp;rdquo;&lt;/li>
&lt;li>Accounting: &amp;ldquo;Month-end processing due today, accounting system down!&amp;rdquo;&lt;/li>
&lt;li>HR: &amp;ldquo;Payroll calculation system stopped! Today is salary payment day!&amp;rdquo;&lt;/li>
&lt;li>Development: &amp;ldquo;Can&amp;rsquo;t access source code management server!&amp;rdquo;&lt;/li>
&lt;/ul>
&lt;h3 id="april-1-800-pm-state-of-emergency-declaration">April 1, 8:00 PM: State of Emergency Declaration
&lt;/h3>&lt;p>&lt;strong>CEO&amp;rsquo;s direct emergency order:&lt;/strong>&lt;/p>
&lt;p>&amp;ldquo;Restore all systems by business start tomorrow (9 AM). If not possible, cancel project and discipline those responsible.&amp;rdquo;&lt;/p>
&lt;p>&lt;strong>Emergency response from 8:00 PM:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Emergency stop of all GCP resources&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">gcloud compute instances stop --all --quiet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Emergency recovery of physical systems&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> server in &lt;span class="k">$(&lt;/span>cat physical_servers.txt&lt;span class="k">)&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">do&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssh root@&lt;span class="nv">$server&lt;/span> &lt;span class="s2">&amp;#34;systemctl start all_services&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">done&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Network configuration recovery&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./restore_physical_network.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>All-night recovery work:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>9:00 PM~3:00 AM: Emergency physical system recovery&lt;/li>
&lt;li>3:00 AM~6:00 AM: Data consistency check&lt;/li>
&lt;li>6:00 AM~8:00 AM: Operation verification&lt;/li>
&lt;/ul>
&lt;h3 id="april-2-900-am-barely-resume-operations">April 2, 9:00 AM: Barely Resume Operations
&lt;/h3>&lt;p>&lt;strong>Recovery results:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>Core systems: 95% recovered&lt;/li>
&lt;li>Email system: 100% recovered&lt;/li>
&lt;li>File servers: 90% recovered (some data loss)&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>However, remaining problems:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>Some SAP ERP data corrupted (50 order records)&lt;/li>
&lt;li>Accounting system March closing process incomplete&lt;/li>
&lt;li>Some HR system attendance data lost&lt;/li>
&lt;/ul>
&lt;p>&amp;ldquo;At least the minimum is working&amp;hellip;&amp;rdquo;&lt;/p>
&lt;h2 id="chapter-5-plant-system-migration-abandonment-and-policy-change">Chapter 5: Plant System Migration Abandonment and Policy Change
&lt;/h2>&lt;h3 id="april-15-plant-system-migration-cancellation-decision">April 15: Plant System Migration Cancellation Decision
&lt;/h3>&lt;p>Following the head office migration chaos, the highest-risk plant system migration was cancelled.&lt;/p>
&lt;p>&lt;strong>Chiba Plant Production Line Control System:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>Windows Server 2003 (20 years in operation)&lt;/li>
&lt;li>VB6 control software (source code lost)&lt;/li>
&lt;li>Proprietary communication protocol with manufacturing equipment&lt;/li>
&lt;li>Shutdown = Complete production line halt = ¥30 million daily loss&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>Gunma Plant Quality Management System:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>Red Hat Enterprise Linux 4 (17 years in operation)&lt;/li>
&lt;li>Oracle 9i (Vendor support ended)&lt;/li>
&lt;li>Direct communication with measuring equipment (RS-232C, Ethernet)&lt;/li>
&lt;li>Shutdown = Quality inspection impossible = Shipping halt&lt;/li>
&lt;/ul>
&lt;p>&amp;ldquo;Migrating this would be suicide&amp;hellip;&amp;rdquo;&lt;/p>
&lt;h3 id="april-20-fundamental-project-review">April 20: Fundamental Project Review
&lt;/h3>&lt;p>&lt;strong>New Policy: Phased Hybridization&lt;/strong>&lt;/p>
&lt;p>Abandoning complete migration, we switched to the following approach:&lt;/p>
&lt;h4 id="phase-1-new-system-cloud-first-start-immediately">Phase 1: New System Cloud-First (Start immediately)
&lt;/h4>&lt;ul>
&lt;li>New systems deployed GCP-native&lt;/li>
&lt;li>Minimal integration with existing systems&lt;/li>
&lt;/ul>
&lt;h4 id="phase-2-individual-migration-of-migrable-systems-6-month-plan">Phase 2: Individual Migration of Migrable Systems (6-month plan)
&lt;/h4>&lt;ul>
&lt;li>Low-risk systems with clear migration benefits&lt;/li>
&lt;li>Ensure sufficient validation period&lt;/li>
&lt;/ul>
&lt;h4 id="phase-3-legacy-system-status-quo-continue-for-now">Phase 3: Legacy System Status Quo (Continue for now)
&lt;/h4>&lt;ul>
&lt;li>Plant systems etc. with too high risk&lt;/li>
&lt;li>Consider gradual modernization&lt;/li>
&lt;/ul>
&lt;h4 id="phase-4-hybrid-infrastructure-optimization-1-year-plan">Phase 4: Hybrid Infrastructure Optimization (1-year plan)
&lt;/h4>&lt;ul>
&lt;li>Appropriate integration of on-premises and cloud&lt;/li>
&lt;li>Balance security and performance&lt;/li>
&lt;/ul>
&lt;h2 id="chapter-6-learning-and-improvement---correct-migration-strategy">Chapter 6: Learning and Improvement - Correct Migration Strategy
&lt;/h2>&lt;h3 id="mayoctober-phased-improvement-implementation">May~October: Phased Improvement Implementation
&lt;/h3>&lt;p>Using lessons learned from failures, we practiced correct migration strategy.&lt;/p>
&lt;h4 id="success-case-1-new-web-application-cloudification">Success Case 1: New Web Application Cloudification
&lt;/h4>&lt;p>&lt;strong>June: Customer Portal Site New Development&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="c"># Correct cloud-native design&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Project&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">customer-portal&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Architecture&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Frontend&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">React (Cloud Run)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Backend&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Node.js API (Cloud Run)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Database&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Cloud SQL (PostgreSQL)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Storage&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Cloud Storage&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">CDN&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Cloud CDN&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Monitoring&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Cloud Operations Suite&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>Results:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>Development period: 3 months (on schedule)&lt;/li>
&lt;li>Operating costs: 60% reduction from conventional&lt;/li>
&lt;li>Performance: 50% improvement in response time&lt;/li>
&lt;li>Availability: 99.95% achieved&lt;/li>
&lt;/ul>
&lt;h4 id="success-case-2-phased-migration-of-sales-support-system">Success Case 2: Phased Migration of Sales Support System
&lt;/h4>&lt;p>&lt;strong>July~September: Sales Force Automation (SFA) Migration&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">Stage 1 (July)&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Start data replication&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Physical DB → Cloud SQL sync setup&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Existing system continues operation&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Data consistency validation&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Stage 2 (August)&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Application migration&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Web UI migrated to Cloud Run&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Backend API divided into Cloud Functions&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Gradual load balancing&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Stage 3 (September)&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Complete migration&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Physical system shutdown&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">DNS switchover&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Enhanced monitoring&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>Migration results:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>Downtime: 2 hours (within plan)&lt;/li>
&lt;li>Data loss: 0 records&lt;/li>
&lt;li>User satisfaction: Improved (better response time)&lt;/li>
&lt;/ul>
&lt;h4 id="success-case-3-file-server-cloud-migration">Success Case 3: File Server Cloud Migration
&lt;/h4>&lt;p>&lt;strong>August~October: File Server Integration&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">Migration strategy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Old&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">5&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">physical file servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">New&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Cloud Storage + Cloud Filestore&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Phase 1&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Data analysis &amp;amp; classification&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Access frequency analysis&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Data classification (Hot/Cold/Archive)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Permission matrix organization&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Phase 2&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Phased migration&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Archive data → Cloud Storage (Coldline)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Cold data → Cloud Storage (Nearline) &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Hot data → Cloud Filestore (NFS)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Phase 3&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Access method optimization&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">Direct access&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Cloud Filestore&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">Web access&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Cloud Storage + CDN&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">Mobile&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Cloud Storage APIs&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="correct-migration-strategy-lessons">Correct Migration Strategy Lessons
&lt;/h3>&lt;h4 id="1-importance-of-advance-investigation">1. Importance of Advance Investigation
&lt;/h4>&lt;p>&lt;strong>Failed investigation:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>Surface-level system configuration only&lt;/li>
&lt;li>Insufficient understanding of dependencies&lt;/li>
&lt;li>Inadequate stakeholder interviews&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>Improved investigation:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-markdown" data-lang="markdown">&lt;span class="line">&lt;span class="cl">&lt;span class="gu">## System Migration Advance Investigation Checklist
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">### Technical Investigation
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">&lt;/span>&lt;span class="k">- [ ]&lt;/span> Network configuration diagram (physical &lt;span class="err">&amp;amp;&lt;/span> logical)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">- [ ]&lt;/span> System dependency map
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">- [ ]&lt;/span> Data flow diagram
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">- [ ]&lt;/span> API &lt;span class="err">&amp;amp;&lt;/span> communication protocol list
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">- [ ]&lt;/span> License &lt;span class="err">&amp;amp;&lt;/span> authentication method verification
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">- [ ]&lt;/span> Performance requirements definition
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">### Business Investigation
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">&lt;/span>&lt;span class="k">- [ ]&lt;/span> User departments &lt;span class="err">&amp;amp;&lt;/span> users identification
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">- [ ]&lt;/span> Business flow &lt;span class="err">&amp;amp;&lt;/span> usage patterns
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">- [ ]&lt;/span> Peak times &lt;span class="err">&amp;amp;&lt;/span> processing volumes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">- [ ]&lt;/span> SLA &lt;span class="err">&amp;amp;&lt;/span> availability requirements
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">- [ ]&lt;/span> Compliance requirements
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">### Organizational Investigation
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">&lt;/span>&lt;span class="k">- [ ]&lt;/span> Stakeholder identification
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">- [ ]&lt;/span> Decision-making process
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">- [ ]&lt;/span> Budget &lt;span class="err">&amp;amp;&lt;/span> resource confirmation
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">- [ ]&lt;/span> Risk tolerance
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">- [ ]&lt;/span> Success metrics definition
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="2-phased-migration-principles">2. Phased Migration Principles
&lt;/h4>&lt;p>&lt;strong>Failed approach:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>Forklift migration (bulk migration)&lt;/li>
&lt;li>Large scope execution at once&lt;/li>
&lt;li>Insufficient backup strategy&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>Improved approach:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">Phased migration strategy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Phase 0&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Investigation &amp;amp; planning (1-2 months)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Phase 1&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Non-critical system early migration (1 month)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Phase 2&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Medium importance system migration (2 months) &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Phase 3&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Critical system migration (3-4 months)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Phase 4&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Optimization &amp;amp; integration (1-2 months)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Each Phase principles&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Small scope&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Sufficient validation period&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Rollback strategy&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Stakeholder approval&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="3-risk-management-framework">3. Risk Management Framework
&lt;/h4>&lt;p>&lt;strong>Migration Risk Matrix:&lt;/strong>&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>System&lt;/th>
&lt;th>Migration Difficulty&lt;/th>
&lt;th>Business Impact&lt;/th>
&lt;th>Priority&lt;/th>
&lt;th>Strategy&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>New Systems&lt;/td>
&lt;td>Low&lt;/td>
&lt;td>Medium&lt;/td>
&lt;td>High&lt;/td>
&lt;td>Cloud Native&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Web Apps&lt;/td>
&lt;td>Low&lt;/td>
&lt;td>High&lt;/td>
&lt;td>High&lt;/td>
&lt;td>Phased Migration&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>File Servers&lt;/td>
&lt;td>Medium&lt;/td>
&lt;td>Medium&lt;/td>
&lt;td>Medium&lt;/td>
&lt;td>Hybrid&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Core Systems&lt;/td>
&lt;td>High&lt;/td>
&lt;td>High&lt;/td>
&lt;td>Low&lt;/td>
&lt;td>Status Quo&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Plant Systems&lt;/td>
&lt;td>Extremely High&lt;/td>
&lt;td>Extremely High&lt;/td>
&lt;td>Excluded&lt;/td>
&lt;td>Consider Modernization&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="chapter-7-one-year-later---reflection-and-results">Chapter 7: One Year Later - Reflection and Results
&lt;/h2>&lt;h3 id="january-2026-project-completion-report">January 2026: Project Completion Report
&lt;/h3>&lt;p>&lt;strong>Final migration results (1 year):&lt;/strong>&lt;/p>
&lt;h4 id="migration-complete-systems">Migration Complete Systems
&lt;/h4>&lt;ul>
&lt;li>New systems: 100% cloud-native&lt;/li>
&lt;li>Web applications: 85% migration complete&lt;/li>
&lt;li>File &amp;amp; storage: 70% migration complete&lt;/li>
&lt;li>Development &amp;amp; test environments: 100% cloud-based&lt;/li>
&lt;/ul>
&lt;h4 id="status-quo-systems">Status Quo Systems
&lt;/h4>&lt;ul>
&lt;li>Core systems (SAP/Accounting): Continue on-premises&lt;/li>
&lt;li>Plant control systems: Continue on-premises&lt;/li>
&lt;li>Legacy business systems: Gradual modernization in progress&lt;/li>
&lt;/ul>
&lt;h4 id="hybrid-environment">Hybrid Environment
&lt;/h4>&lt;ul>
&lt;li>On-premises ⟷ GCP: Stable VPN connection&lt;/li>
&lt;li>Integrated monitoring: Cloud Operations Suite&lt;/li>
&lt;li>Integrated ID management: Google Cloud Identity&lt;/li>
&lt;/ul>
&lt;h3 id="results-by-numbers">Results by Numbers
&lt;/h3>&lt;p>&lt;strong>Cost effectiveness:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Previous (Physical environment only):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Infrastructure cost: ¥15M/year
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Operations personnel cost: ¥25M/year
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Maintenance cost: ¥8M/year
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Power &amp;amp; facility cost: ¥5M/year
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Total: ¥53M/year
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Current (Hybrid environment):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- GCP cost: ¥8M/year
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Physical infrastructure cost: ¥6M/year (reduced)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Operations personnel cost: ¥18M/year (efficiency)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Maintenance cost: ¥3M/year (reduced)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Power &amp;amp; facility cost: ¥2M/year (reduced)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Total: ¥37M/year
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Annual reduction: ¥16M (30% reduction)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>Performance improvements:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">System availability:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Before migration: 97.8% (approximately 16 hours downtime monthly)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- After migration: 99.5% (approximately 4 hours downtime monthly)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Web application response time:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Before migration: Average 2.3 seconds
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- After migration: Average 0.8 seconds (65% improvement)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Development &amp;amp; deployment time:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Before migration: Average 3 weeks to new feature release
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- After migration: Average 1 week to new feature release
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>Organizational improvements:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">IT department work allocation:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Before migration: Operations &amp;amp; maintenance 70%, New development 30%
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- After migration: Operations &amp;amp; maintenance 40%, New development 60%
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Engineer satisfaction:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Before migration: 6.2/10 (Legacy operation burden)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- After migration: 8.1/10 (Modern technology development)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Business department satisfaction:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Before migration: 7.0/10 (Stable but slow improvement)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- After migration: 8.5/10 (Rapid new feature delivery)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="most-valuable-learning">Most Valuable Learning
&lt;/h3>&lt;h4 id="1-practical-hybrid-over-perfect-migration">1. Practical Hybrid Over Perfect Migration
&lt;/h4>&lt;p>&lt;strong>Old thinking:&lt;/strong>
&amp;ldquo;Migration must be complete to be meaningful&amp;rdquo;&lt;/p>
&lt;p>&lt;strong>Truth learned:&lt;/strong>
&amp;ldquo;Placing appropriate systems in appropriate locations is important&amp;rdquo;&lt;/p>
&lt;h4 id="2-organizational-challenges-harder-than-technical">2. Organizational Challenges Harder Than Technical
&lt;/h4>&lt;p>&lt;strong>Technical problems:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>IP address changes&lt;/li>
&lt;li>Inter-system integration&lt;/li>
&lt;li>Data migration&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>Organizational problems (more difficult):&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>Inter-department interest coordination&lt;/li>
&lt;li>Resistance to change&lt;/li>
&lt;li>Ambiguous responsibility boundaries&lt;/li>
&lt;/ul>
&lt;h4 id="3-small-successes-build-trust">3. Small Successes Build Trust
&lt;/h4>&lt;p>The trust lost from initial major failures was recovered through accumulation of small successes.&lt;/p>
&lt;p>&lt;strong>Trust recovery process:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Month 1-3: Major failure (Trust level 2/10)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Month 4-6: Small successes x3 (Trust level 4/10)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Month 7-9: Medium successes x2 (Trust level 6/10)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Month 10-12: Major success x1 (Trust level 8/10)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="summary-what-30-million-and-6-months-of-hell-taught-us">Summary: What ¥30 Million and 6 Months of Hell Taught Us
&lt;/h2>&lt;h3 id="project-total-cost">Project Total Cost
&lt;/h3>&lt;p>&lt;strong>Direct costs:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>Migration work expenses: ¥12M&lt;/li>
&lt;li>System recovery expenses: ¥8M&lt;/li>
&lt;li>External consultant fees: ¥6M&lt;/li>
&lt;li>GCP usage fees (failed portion): ¥2M&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>Indirect costs:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>Business downtime opportunity loss: ¥15M&lt;/li>
&lt;li>Data recovery work: ¥3M&lt;/li>
&lt;li>Additional personnel costs (overtime/weekend work): ¥4M&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>Total cost: ¥50M&lt;/strong>
&lt;strong>Wasted costs: ¥30M&lt;/strong>&lt;/p>
&lt;h3 id="most-important-lessons">Most Important Lessons
&lt;/h3>&lt;h4 id="1-its-easy-is-the-greatest-trap-for-engineers">1. &amp;ldquo;It&amp;rsquo;s Easy&amp;rdquo; is the Greatest Trap for Engineers
&lt;/h4>&lt;p>&lt;strong>Migrating legacy systems accumulated over 20 years is never easy.&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>Invisible dependencies&lt;/li>
&lt;li>Lost knowledge (creator retirement)&lt;/li>
&lt;li>Hardcoded configurations&lt;/li>
&lt;li>Tight coupling with business flows&lt;/li>
&lt;/ul>
&lt;h4 id="2-phased-approach-is-tedious-but-ultimately-fastest">2. Phased Approach is Tedious But Ultimately Fastest
&lt;/h4>&lt;p>&lt;strong>Bulk migration temptation:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&amp;ldquo;Doing it all at once is more efficient&amp;rdquo;&lt;/li>
&lt;li>&amp;ldquo;Considering rollback costs&amp;hellip;&amp;rdquo;&lt;/li>
&lt;li>&amp;ldquo;Want to shorten project duration&amp;rdquo;&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>Reality:&lt;/strong>
Considering bulk migration failure risks, phased migration is most reliable and ultimately fastest.&lt;/p>
&lt;h4 id="3-organizational-solutions-more-important-than-technical">3. Organizational Solutions More Important Than Technical
&lt;/h4>&lt;p>&lt;strong>Success factors:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>Technical accuracy: 30%&lt;/li>
&lt;li>Organizational coordination: 70%&lt;/li>
&lt;/ul>
&lt;p>Stakeholder coordination, expectation management, and change management are keys to migration success.&lt;/p>
&lt;h3 id="recommendations-for-other-organizations">Recommendations for Other Organizations
&lt;/h3>&lt;h4 id="pre-cloud-migration-checklist">Pre-Cloud Migration Checklist
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-markdown" data-lang="markdown">&lt;span class="line">&lt;span class="cl">&lt;span class="gu">## Legacy System Migration Essential Checklist
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">### Level 1: Migration Feasibility Assessment
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">&lt;/span>&lt;span class="k">- [ ]&lt;/span> Confirm system creation year &lt;span class="err">&amp;amp;&lt;/span> technology stack
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">- [ ]&lt;/span> Confirm creator/maintenance personnel employment
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">- [ ]&lt;/span> Confirm source code/design document availability
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">- [ ]&lt;/span> Confirm license/contract conditions
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">### Level 2: Dependency Investigation
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">&lt;/span>&lt;span class="k">- [ ]&lt;/span> Complete mapping of inter-system communication
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">- [ ]&lt;/span> Create data flow diagrams
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">- [ ]&lt;/span> Identify network dependencies
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">- [ ]&lt;/span> Confirm external system/service integration
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">### Level 3: Business Impact Assessment
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">&lt;/span>&lt;span class="k">- [ ]&lt;/span> Identify business impact scope of downtime
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">- [ ]&lt;/span> Confirm SLA/availability requirements
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">- [ ]&lt;/span> Understand peak times/processing volumes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">- [ ]&lt;/span> Confirm regulatory/compliance requirements
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">### Level 4: Risk Assessment &amp;amp; Countermeasures
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">&lt;/span>&lt;span class="k">- [ ]&lt;/span> Calculate migration failure impact
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">- [ ]&lt;/span> Develop rollback strategy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">- [ ]&lt;/span> Establish emergency contact system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">- [ ]&lt;/span> Implement backup/recovery testing
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="recommended-migration-strategy">Recommended Migration Strategy
&lt;/h4>&lt;p>&lt;strong>Green Field (New Development) Priority Approach:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">Priority 1&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">New systems&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="m">100&lt;/span>&lt;span class="l">% cloud-native&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Latest architecture &amp;amp; technology choices&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Minimal integration with existing systems&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Priority 2&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Web frontends&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Relatively low migration risk&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">High user experience improvement effect&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Phased migration possible&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Priority 3&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Data &amp;amp; storage&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">High backup &amp;amp; DR effect&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Phased migration possible&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Can coexist with existing systems&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Priority 4&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Core systems&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Consider modernization&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Long-term plan (3-5 years)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Status quo also an option&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="finally-the-value-of-learning-from-failure">Finally: The Value of Learning from Failure
&lt;/h3>&lt;p>This six months of hell was certainly a painful experience, but ultimately made our IT organization grow significantly.&lt;/p>
&lt;p>&lt;strong>What we gained:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>Deep understanding of legacy systems&lt;/li>
&lt;li>Recognition of risk management importance&lt;/li>
&lt;li>Phased approach skills&lt;/li>
&lt;li>Stakeholder management capability&lt;/li>
&lt;li>Improved team cohesion&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>Most important learning:&lt;/strong>
The value of learning from failures and continuing improvement, rather than avoiding challenges out of fear of failure.&lt;/p>
&lt;p>I hope organizations undertaking similar migration projects won&amp;rsquo;t repeat the same failures we experienced.&lt;/p>
&lt;p>And I believe that if you do fail, by continuing to improve without giving up, you will surely reach success.&lt;/p>
&lt;hr>
&lt;p>&lt;strong>Related articles:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://firebird-techtalktech.com/tags/cloud-migration/" >Cloud Migration Phased Approach Practice Guide&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://firebird-techtalktech.com/categories/infrastructure/" >Legacy System Modernization Strategy&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://firebird-techtalktech.com/tags/hybrid-cloud/" >Hybrid Cloud Operations Best Practices&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>Note:&lt;/strong> This article is based on actual migration project experience, but company names and system details have been anonymized and generalized.&lt;/p></description></item></channel></rss>